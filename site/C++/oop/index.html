
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>OOP Notes for exam - Colin's Notebook</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#oop-notes-for-exam" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Colin&#39;s Notebook" class="md-header__button md-logo" aria-label="Colin's Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Colin's Notebook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OOP Notes for exam
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="" type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="" type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/Co1lin/notes/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Colin&#39;s Notebook" class="md-nav__button md-logo" aria-label="Colin's Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Colin's Notebook
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/Co1lin/notes/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome to Colin's Notebook
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../DSA_Review/" class="md-nav__link">
        DSA
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../LaTex/" class="md-nav__link">
        LaTeX
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/" class="md-nav__link">
        Linux
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Python/" class="md-nav__link">
        Python
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Quantitive%20Investment/" class="md-nav__link">
        Quantitive Investment & Financial Optimization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../SystemVerilog/" class="md-nav__link">
        SystemVerilog
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      <label class="md-nav__link" for="__nav_8">
        C++
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="C++" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          C++
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DSA01/" class="md-nav__link">
        DSA01
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          OOP Notes for exam
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        OOP Notes for exam
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 基本写法
  </a>
  
    <nav class="md-nav" aria-label="1. 基本写法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-makefile" class="md-nav__link">
    1.1 Makefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-argv" class="md-nav__link">
    1.2 程序命令行参数 argv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-gdb" class="md-nav__link">
    1.3 gdb调试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-overload" class="md-nav__link">
    1.4 函数重载 overload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-auto" class="md-nav__link">
    1.5 auto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-decltype" class="md-nav__link">
    1.6 decltype
  </a>
  
    <nav class="md-nav" aria-label="1.6 decltype">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161" class="md-nav__link">
    1.6.1 更高级的返回值推导用法
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-new-delete" class="md-nav__link">
    1.7 new &amp; delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18" class="md-nav__link">
    1.8 避免重复包含头文件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-operator" class="md-nav__link">
    2. operator&lt;
  </a>
  
    <nav class="md-nav" aria-label="2. operator&lt;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-operator" class="md-nav__link">
    2.1 operator++
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-operator" class="md-nav__link">
    2.2 operator[]
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-operator" class="md-nav__link">
    2.3 operator&lt;&lt;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    2.4 友元与友元类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-static" class="md-nav__link">
    2.5 静态 static
  </a>
  
    <nav class="md-nav" aria-label="2.5 静态 static">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251" class="md-nav__link">
    2.5.1 静态数据成员（静态成员变量）（“类变量”）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252" class="md-nav__link">
    2.5.2 静态成员函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26" class="md-nav__link">
    2.6 引用
  </a>
  
    <nav class="md-nav" aria-label="2.6 引用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#261" class="md-nav__link">
    2.6.1 引用传参不构造也不析构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#262" class="md-nav__link">
    2.6.2 引用不能改指向
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    2.7 拷贝构造函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28" class="md-nav__link">
    2.8 右值引用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#29" class="md-nav__link">
    2.9 移动构造函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#210" class="md-nav__link">
    2.10 拷贝赋值运算符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    2.11 移动赋值运算符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    2.12 自动类型转换
  </a>
  
    <nav class="md-nav" aria-label="2.12 自动类型转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121" class="md-nav__link">
    2.12.1 目标类型转换运算符
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    2.13 构造函数转换法
  </a>
  
    <nav class="md-nav" aria-label="2.13 构造函数转换法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2131" class="md-nav__link">
    2.13.1 禁止自动类型转换
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214" class="md-nav__link">
    2.14 强制类型转换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215" class="md-nav__link">
    2.15 类的组合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216" class="md-nav__link">
    2.16 类的继承
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217-redefining" class="md-nav__link">
    2.17 重写隐藏 redefining
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#218" class="md-nav__link">
    2.18 向上类型转换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#219" class="md-nav__link">
    2.19 虚函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#220-override" class="md-nav__link">
    2.20 重写覆盖 override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#221" class="md-nav__link">
    2.21 抽象类与纯虚函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-dynamic_cast" class="md-nav__link">
    2.22 向下类型转换 dynamic_cast
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-template" class="md-nav__link">
    2.23 模板 template
  </a>
  
    <nav class="md-nav" aria-label="2.23 模板 template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2231" class="md-nav__link">
    2.23.1 传递数组作为函数参数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-thread" class="md-nav__link">
    2.24 多线程 thread
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#225" class="md-nav__link">
    2.25 主从模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-mutex" class="md-nav__link">
    2.26 互斥锁模式 mutex
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#227-async-future" class="md-nav__link">
    2.27 异步 async future
  </a>
  
    <nav class="md-nav" aria-label="2.27 异步 async future">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2271" class="md-nav__link">
    2.27.1 轮询
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#228-promise" class="md-nav__link">
    2.28 promise
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229" class="md-nav__link">
    2.29 函数指针
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#230" class="md-nav__link">
    2.30 函数对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#231-function" class="md-nav__link">
    2.31 function 类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    2.32 智能指针
  </a>
  
    <nav class="md-nav" aria-label="2.32 智能指针">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2321-unique_ptr" class="md-nav__link">
    2.32.1 unique_ptr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2322-shared_ptr" class="md-nav__link">
    2.32.2 shared_ptr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2323-weak_ptr" class="md-nav__link">
    2.32.3 weak_ptr 弱引用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233-lambda" class="md-nav__link">
    2.33 Lambda 函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#234" class="md-nav__link">
    2.34 行为型模式
  </a>
  
    <nav class="md-nav" aria-label="2.34 行为型模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2341" class="md-nav__link">
    2.34.1 迭代器模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2342" class="md-nav__link">
    2.34.2 模板方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2343" class="md-nav__link">
    2.34.3 策略模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#235" class="md-nav__link">
    2.35 结构型模式
  </a>
  
    <nav class="md-nav" aria-label="2.35 结构型模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2351" class="md-nav__link">
    2.35.1 适配器模式
  </a>
  
    <nav class="md-nav" aria-label="2.35.1 适配器模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23511" class="md-nav__link">
    2.35.1.1 组合适配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23512" class="md-nav__link">
    2.35.1.2 继承适配
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2352" class="md-nav__link">
    2.35.2 代理/委托模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2353" class="md-nav__link">
    2.35.3 装饰器模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#236" class="md-nav__link">
    2.36 创建型模式
  </a>
  
    <nav class="md-nav" aria-label="2.36 创建型模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2361" class="md-nav__link">
    2.36.1 单例模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2362" class="md-nav__link">
    2.36.2 工厂模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2363" class="md-nav__link">
    2.36.3 抽象工厂模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 实用工具类知识
  </a>
  
    <nav class="md-nav" aria-label="3. 实用工具类知识">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 排序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 字符串类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-fstream" class="md-nav__link">
    3.3 文件读写 fstream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 输入
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    3.5 输出
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-string" class="md-nav__link">
    3.6 string
  </a>
  
    <nav class="md-nav" aria-label="3.6 string">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#361" class="md-nav__link">
    3.6.1 截取
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#362-charint-stoi" class="md-nav__link">
    3.6.2 char[]转整型int (stoi)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#363-number-to-string" class="md-nav__link">
    3.6.3 number to string
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#364-sstream" class="md-nav__link">
    3.6.4 sstream 转换
  </a>
  
    <nav class="md-nav" aria-label="3.6.4 sstream 转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3641-sstream" class="md-nav__link">
    3.6.4.1 sstream复用的坑
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3642-sstream" class="md-nav__link">
    3.6.4.2 sstream拼接多个字符串
  </a>
  
    <nav class="md-nav" aria-label="3.6.4.2 sstream拼接多个字符串">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#36421-ss" class="md-nav__link">
    3.6.4.2.1 新的ss一次性拼接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36422-ss" class="md-nav__link">
    3.6.4.2.2 用过的ss在尾部添加
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3643-stringstream" class="md-nav__link">
    3.6.4.3 基于stringstream的类型转换模板函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-vector" class="md-nav__link">
    3.7 vector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    3.8 正则表达式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39-isdigit" class="md-nav__link">
    3.9 判断一个字符是否是数字 isdigit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Computer Network
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Computer Network" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Computer Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Computer%20Network/1-introduction/" class="md-nav__link">
        1 Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Computer%20Network/2-application%20layer/" class="md-nav__link">
        2 Application Layer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Computer%20Network/3-transport%20layer/" class="md-nav__link">
        3 Transport Layer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Computer%20Network/4-network%20layer/" class="md-nav__link">
        4 Network Layer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Computer%20Network/5-MAC%20Sublayer/" class="md-nav__link">
        5 MAC Sublayer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Computer%20Network/6-Data%20Link%20Layer/" class="md-nav__link">
        6 Data Link Layer
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      <label class="md-nav__link" for="__nav_10">
        Deep RL
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Deep RL" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Deep RL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Deep%20RL/Policy%20Gradient/" class="md-nav__link">
        Policy Gradient
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        Intro. to AI
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Intro. to AI" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Intro. to AI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Intro.%20to%20AI/DT/" class="md-nav__link">
        Decision Tree
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Intro.%20to%20AI/GA/" class="md-nav__link">
        Genetic Algorithm
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Intro.%20to%20AI/Naive%20Bayes%20Classifier/" class="md-nav__link">
        Naive Bayes Classifier
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Intro.%20to%20AI/SVM/" class="md-nav__link">
        SVM
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Jupyter
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Jupyter" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Jupyter
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Jupyter/jupyter/" class="md-nav__link">
        Jupyter
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      <label class="md-nav__link" for="__nav_13">
        Machine Learning
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Machine Learning" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Machine Learning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/Attention/" class="md-nav__link">
        Self-Attention
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/Auto-encoder/" class="md-nav__link">
        Auto-encoder
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/BERT/" class="md-nav__link">
        BERT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/Basis/" class="md-nav__link">
        Basis
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/CNN/" class="md-nav__link">
        CNN
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/Detection%20%26%20Segmentation/" class="md-nav__link">
        Detection & Segmentation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/GPT/" class="md-nav__link">
        GPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/Generative%20Models/" class="md-nav__link">
        Generative Models
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/Image%20Classification/" class="md-nav__link">
        Image Classification
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/LLL/" class="md-nav__link">
        Life Long Learning
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/RNN/" class="md-nav__link">
        RNN
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/Reinforcement%20Learning/" class="md-nav__link">
        Reinforcement Learning
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Machine%20Learning/Transformer/" class="md-nav__link">
        Transformer
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" type="checkbox" id="__nav_14" >
      
      <label class="md-nav__link" for="__nav_14">
        Software Engineering
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Software Engineering" data-md-level="1">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Software Engineering
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Software%20Engineering/Vue/" class="md-nav__link">
        Vue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Software%20Engineering/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 基本写法
  </a>
  
    <nav class="md-nav" aria-label="1. 基本写法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-makefile" class="md-nav__link">
    1.1 Makefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-argv" class="md-nav__link">
    1.2 程序命令行参数 argv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-gdb" class="md-nav__link">
    1.3 gdb调试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-overload" class="md-nav__link">
    1.4 函数重载 overload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-auto" class="md-nav__link">
    1.5 auto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-decltype" class="md-nav__link">
    1.6 decltype
  </a>
  
    <nav class="md-nav" aria-label="1.6 decltype">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161" class="md-nav__link">
    1.6.1 更高级的返回值推导用法
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-new-delete" class="md-nav__link">
    1.7 new &amp; delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18" class="md-nav__link">
    1.8 避免重复包含头文件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-operator" class="md-nav__link">
    2. operator&lt;
  </a>
  
    <nav class="md-nav" aria-label="2. operator&lt;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-operator" class="md-nav__link">
    2.1 operator++
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-operator" class="md-nav__link">
    2.2 operator[]
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-operator" class="md-nav__link">
    2.3 operator&lt;&lt;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    2.4 友元与友元类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-static" class="md-nav__link">
    2.5 静态 static
  </a>
  
    <nav class="md-nav" aria-label="2.5 静态 static">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251" class="md-nav__link">
    2.5.1 静态数据成员（静态成员变量）（“类变量”）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252" class="md-nav__link">
    2.5.2 静态成员函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26" class="md-nav__link">
    2.6 引用
  </a>
  
    <nav class="md-nav" aria-label="2.6 引用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#261" class="md-nav__link">
    2.6.1 引用传参不构造也不析构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#262" class="md-nav__link">
    2.6.2 引用不能改指向
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    2.7 拷贝构造函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28" class="md-nav__link">
    2.8 右值引用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#29" class="md-nav__link">
    2.9 移动构造函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#210" class="md-nav__link">
    2.10 拷贝赋值运算符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    2.11 移动赋值运算符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    2.12 自动类型转换
  </a>
  
    <nav class="md-nav" aria-label="2.12 自动类型转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121" class="md-nav__link">
    2.12.1 目标类型转换运算符
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    2.13 构造函数转换法
  </a>
  
    <nav class="md-nav" aria-label="2.13 构造函数转换法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2131" class="md-nav__link">
    2.13.1 禁止自动类型转换
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214" class="md-nav__link">
    2.14 强制类型转换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215" class="md-nav__link">
    2.15 类的组合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216" class="md-nav__link">
    2.16 类的继承
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217-redefining" class="md-nav__link">
    2.17 重写隐藏 redefining
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#218" class="md-nav__link">
    2.18 向上类型转换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#219" class="md-nav__link">
    2.19 虚函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#220-override" class="md-nav__link">
    2.20 重写覆盖 override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#221" class="md-nav__link">
    2.21 抽象类与纯虚函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-dynamic_cast" class="md-nav__link">
    2.22 向下类型转换 dynamic_cast
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-template" class="md-nav__link">
    2.23 模板 template
  </a>
  
    <nav class="md-nav" aria-label="2.23 模板 template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2231" class="md-nav__link">
    2.23.1 传递数组作为函数参数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-thread" class="md-nav__link">
    2.24 多线程 thread
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#225" class="md-nav__link">
    2.25 主从模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-mutex" class="md-nav__link">
    2.26 互斥锁模式 mutex
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#227-async-future" class="md-nav__link">
    2.27 异步 async future
  </a>
  
    <nav class="md-nav" aria-label="2.27 异步 async future">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2271" class="md-nav__link">
    2.27.1 轮询
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#228-promise" class="md-nav__link">
    2.28 promise
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229" class="md-nav__link">
    2.29 函数指针
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#230" class="md-nav__link">
    2.30 函数对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#231-function" class="md-nav__link">
    2.31 function 类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    2.32 智能指针
  </a>
  
    <nav class="md-nav" aria-label="2.32 智能指针">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2321-unique_ptr" class="md-nav__link">
    2.32.1 unique_ptr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2322-shared_ptr" class="md-nav__link">
    2.32.2 shared_ptr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2323-weak_ptr" class="md-nav__link">
    2.32.3 weak_ptr 弱引用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233-lambda" class="md-nav__link">
    2.33 Lambda 函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#234" class="md-nav__link">
    2.34 行为型模式
  </a>
  
    <nav class="md-nav" aria-label="2.34 行为型模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2341" class="md-nav__link">
    2.34.1 迭代器模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2342" class="md-nav__link">
    2.34.2 模板方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2343" class="md-nav__link">
    2.34.3 策略模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#235" class="md-nav__link">
    2.35 结构型模式
  </a>
  
    <nav class="md-nav" aria-label="2.35 结构型模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2351" class="md-nav__link">
    2.35.1 适配器模式
  </a>
  
    <nav class="md-nav" aria-label="2.35.1 适配器模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23511" class="md-nav__link">
    2.35.1.1 组合适配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23512" class="md-nav__link">
    2.35.1.2 继承适配
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2352" class="md-nav__link">
    2.35.2 代理/委托模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2353" class="md-nav__link">
    2.35.3 装饰器模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#236" class="md-nav__link">
    2.36 创建型模式
  </a>
  
    <nav class="md-nav" aria-label="2.36 创建型模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2361" class="md-nav__link">
    2.36.1 单例模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2362" class="md-nav__link">
    2.36.2 工厂模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2363" class="md-nav__link">
    2.36.3 抽象工厂模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 实用工具类知识
  </a>
  
    <nav class="md-nav" aria-label="3. 实用工具类知识">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 排序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 字符串类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-fstream" class="md-nav__link">
    3.3 文件读写 fstream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 输入
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    3.5 输出
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-string" class="md-nav__link">
    3.6 string
  </a>
  
    <nav class="md-nav" aria-label="3.6 string">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#361" class="md-nav__link">
    3.6.1 截取
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#362-charint-stoi" class="md-nav__link">
    3.6.2 char[]转整型int (stoi)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#363-number-to-string" class="md-nav__link">
    3.6.3 number to string
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#364-sstream" class="md-nav__link">
    3.6.4 sstream 转换
  </a>
  
    <nav class="md-nav" aria-label="3.6.4 sstream 转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3641-sstream" class="md-nav__link">
    3.6.4.1 sstream复用的坑
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3642-sstream" class="md-nav__link">
    3.6.4.2 sstream拼接多个字符串
  </a>
  
    <nav class="md-nav" aria-label="3.6.4.2 sstream拼接多个字符串">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#36421-ss" class="md-nav__link">
    3.6.4.2.1 新的ss一次性拼接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36422-ss" class="md-nav__link">
    3.6.4.2.2 用过的ss在尾部添加
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3643-stringstream" class="md-nav__link">
    3.6.4.3 基于stringstream的类型转换模板函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-vector" class="md-nav__link">
    3.7 vector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    3.8 正则表达式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39-isdigit" class="md-nav__link">
    3.9 判断一个字符是否是数字 isdigit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
  
                
                  <a href="https://github.com/Co1lin/notes/edit/master/docs/C++/oop.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="oop-notes-for-exam">OOP Notes for exam</h1>
<h2 id="1">1. 基本写法</h2>
<h3 id="11-makefile">1.1 Makefile</h3>
<p>常规版：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nf">all</span><span class="o">:</span> <span class="n">test</span>   <span class="c"># 只输入make它就找第一个</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="nf">test</span><span class="o">:</span> <span class="n">product</span>.<span class="n">o</span> <span class="n">sum</span>.<span class="n">o</span> <span class="n">main</span>.<span class="n">o</span> <span class="n">functions</span>.<span class="n">h</span>
<span class="linenos" data-linenos=" 4 "></span>    g++ product.o sum.o main.o -o <span class="nb">test</span>  <span class="c1"># specify the name of the output</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="nf">product.o</span><span class="o">:</span> <span class="n">product</span>.<span class="n">cpp</span> <span class="n">functions</span>.<span class="n">h</span>
<span class="linenos" data-linenos=" 7 "></span>    g++ -c product.cpp -o product.o <span class="c1"># -c表示只编译不链接</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="nf">sum.o</span><span class="o">:</span> <span class="n">sum</span>.<span class="n">cpp</span> <span class="n">functions</span>.<span class="n">h</span>
<span class="linenos" data-linenos="10 "></span>    g++ -c sum.cpp -o sum.o
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="nf">main.o</span><span class="o">:</span> <span class="n">main</span>.<span class="n">cpp</span> <span class="n">functions</span>.<span class="n">h</span>
<span class="linenos" data-linenos="13 "></span>    g++ -c main.cpp -o main.o
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="nf">clean</span><span class="o">:</span>  <span class="c"># clean不是第一个的依赖因此不会自动运行，所以需要make clean</span>
<span class="linenos" data-linenos="16 "></span>    rm *.o <span class="nb">test</span>
</code></pre></div>
<p>比较通用的版本：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c">####################################</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c"># Learnt from Internet</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c"># Edited by Colin</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c"># 2020.02</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c">####################################</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nv">cc</span> <span class="o">=</span> g++
<span class="linenos" data-linenos=" 7 "></span><span class="nv">FLAG</span> <span class="o">=</span> 
<span class="linenos" data-linenos=" 8 "></span><span class="nv">DEF</span> <span class="o">=</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nv">CXXFLAGS</span> <span class="o">=</span> -std<span class="o">=</span>c++17 -O3
<span class="linenos" data-linenos="10 "></span><span class="nv">prom</span> <span class="o">=</span> main
<span class="linenos" data-linenos="11 "></span><span class="nv">deps</span> <span class="o">=</span> <span class="k">$(</span>shell find . -maxdepth <span class="m">10</span> -name <span class="s2">&quot;*.h&quot;</span> -or -name <span class="s2">&quot;*.hpp&quot;</span><span class="k">)</span>
<span class="linenos" data-linenos="12 "></span><span class="nv">src</span> <span class="o">=</span> <span class="k">$(</span>shell find . -maxdepth <span class="m">10</span> -name <span class="s2">&quot;*.cpp&quot;</span><span class="k">)</span>
<span class="linenos" data-linenos="13 "></span><span class="nv">obj</span> <span class="o">=</span> <span class="k">$(</span>src:%.cpp<span class="o">=</span>%.o<span class="k">)</span> 
<span class="linenos" data-linenos="14 "></span><span class="nf">$(prom)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">obj</span><span class="k">)</span>
<span class="linenos" data-linenos="15 "></span>    <span class="k">$(</span>cc<span class="k">)</span> -o <span class="k">$(</span>prom<span class="k">)</span> <span class="k">$(</span>obj<span class="k">)</span>
<span class="linenos" data-linenos="16 "></span><span class="nf">%.o</span><span class="o">:</span> %.<span class="n">cpp</span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">$(</span>cc<span class="k">)</span> <span class="k">$(</span>CXXFLAGS<span class="k">)</span> <span class="k">$(</span>FLAG<span class="k">)</span> <span class="k">$(</span>DEF<span class="k">)</span> -c $&lt; -o <span class="nv">$@</span>
<span class="linenos" data-linenos="18 "></span><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">clean</span> 
<span class="linenos" data-linenos="19 "></span><span class="nf">clean</span><span class="o">:</span>
<span class="linenos" data-linenos="20 "></span>    rm -rf <span class="k">$(</span>prom<span class="k">)</span> <span class="k">$(</span>obj<span class="k">)</span>
</code></pre></div>
<h3 id="12-argv">1.2 程序命令行参数 argv</h3>
<p>例子</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="c1">// or char*[] argv</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="n">a</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="linenos" data-linenos="5 "></span>    <span class="n">b</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos" data-linenos="6 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span> 
</code></pre></div>
<p>argc是参数的数量，算上程序名argv[0]。遍历argc时有用，因为argc不好知道有几个。</p>
<p>argv是参数。第n个参数为argv[n]。</p>
<h3 id="13-gdb">1.3 gdb调试</h3>
<p>g++ -g a.cpp –o a.out编译程序</p>
<p>gdb a.out 调试a.out程序</p>
<p>run  运行程序<br />
break + 行号 设置断点<br />
break 10 if (k==2) 可根据具体运行条件断点
delete break 1 删除1号断点
watch x 当x的值发生变化时暂停
continue 跳至下一个断点
step 单步执行(进入)<br />
next 单步执行(不进入)
print x 输出变量/表达式x<br />
GDB中输入 p x=1，程序中x的值会被手动修改为1
display x 持续监测变量/表达式x
list 列出程序源代码<br />
quit 退出
回车 重复上一条指令</p>
<p>所有命令都可以缩写为前几个字母，只要保持唯一，如<code>next</code>可缩写为<code>n</code>。</p>
<p>info break看断点信息</p>
<p>Disp 列代表断点被命中后，该断点保留(keep)、删除(del)还是关闭(dis)</p>
<p>https://zhuanlan.zhihu.com/p/29468840</p>
<h3 id="14-overload">1.4 函数重载 overload</h3>
<p>同名、<strong>参数必须不同</strong>。作用域相同。返回值可相同也可不同。<strong>根据函数调用语句的实际参数决定哪一个函数被调用</strong>。</p>
<p>属于静态多态。编译时就知道。</p>
<p>内置类型转换：当函数重载时，会优先调用类型匹配的函数实现，否则才会进行类型转换</p>
<h3 id="15-auto">1.5 auto</h3>
<p>函数参数不能是auto类型。</p>
<p><strong>追踪返回类型的函数</strong></p>
<p>可以将函数返回类型的声明信息放到函数参数列表的后面进行声明</p>
<p><code>auto func(char* ptr, int val) -&gt; int;</code></p>
<h3 id="16-decltype">1.6 decltype</h3>
<p>类型推导。<code>decltype(a)</code></p>
<h4 id="161">1.6.1 更高级的返回值推导用法</h4>
<p>https://github.com/thu-coai/THUOOP/issues/24</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1">// 得到一个类型的退化版本</span>
<span class="linenos" data-linenos="2 "></span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="kt">double</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">3.14</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="n">decay_t</span><span class="o">&lt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span><span class="p">;</span> <span class="c1">// int</span>
<span class="linenos" data-linenos="6 "></span><span class="c1">// 得到“更通用版本”</span>
<span class="linenos" data-linenos="7 "></span><span class="n">common_type_t</span><span class="o">&lt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span><span class="p">;</span> <span class="c1">// int; 一个就直接退化</span>
<span class="linenos" data-linenos="8 "></span><span class="n">common_type_t</span><span class="o">&lt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="k">decltype</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span><span class="p">;</span>  <span class="c1">// double</span>
</code></pre></div>
<p>例子：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// max 函数</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">std</span><span class="o">::</span><span class="n">common_type_t</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="o">&gt;</span> <span class="n">max</span><span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// 返回容器的第一个元素值</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">A</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">auto</span> <span class="n">work2</span><span class="p">(</span><span class="k">const</span> <span class="n">A</span><span class="o">&amp;</span> <span class="n">_array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">common_type_t</span><span class="o">&lt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">_array</span><span class="p">.</span><span class="n">front</span><span class="p">())</span> <span class="o">&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">return</span> <span class="n">_array</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="c1">// 仿照此方法可以把容器中的元素包装进模板类再返回</span>
<span class="linenos" data-linenos="13 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">A</span><span class="o">&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="k">auto</span> <span class="n">work2</span><span class="p">(</span><span class="k">const</span> <span class="n">A</span><span class="o">&amp;</span> <span class="n">_array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MyArray</span> <span class="o">&lt;</span> <span class="n">common_type_t</span><span class="o">&lt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">_array</span><span class="p">.</span><span class="n">front</span><span class="p">())</span> <span class="o">&gt;</span> <span class="o">&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>    <span class="cm">/* ... */</span>
<span class="linenos" data-linenos="17 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="17-new-delete">1.7 new &amp; delete</h3>
<p><code>delete[] array</code></p>
<p>详细过程见PPT L5 P42</p>
<h3 id="18">1.8 避免重复包含头文件</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">#ifndef MATRIX_H</span>
<span class="linenos" data-linenos="2 "></span><span class="cp">#define MATRIX_H</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="cp">#endif </span>
</code></pre></div>
<p>Or</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">#pragma once</span>
</code></pre></div>
<p>对比：</p>
<ol>
<li>
<p>后者效率更高。 原因： 前者要每次读入整个文件来处理，后者第二次读入相同文件的时候会直接跳过， 不会产生file IO。
   但是大部分编译器也针对前者的效率进行了优化，实际效率可能像差不多。</p>
</li>
<li>
<p>后者以来文件系统的文件名，因此如果有符号链接/两个文件内容相同，则会被引入两次。</p>
</li>
<li>
<p>前者在标准内，后者不在，但是被<a href="https://en.wikipedia.org/wiki/Pragma_once#Portability">绝大部分编译器</a>支持。</p>
</li>
</ol>
<h2 id="2-operator">2. operator&lt;</h2>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span> <span class="p">(</span><span class="k">const</span> <span class="n">Computer</span><span class="o">&amp;</span> <span class="n">_y</span><span class="p">)</span> <span class="k">const</span> <span class="c1">// const declares that this function would not modify this.</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="21-operator">2.1 operator++</h3>
<p>前缀：直接++</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Test</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span> <span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="o">++</span><span class="n">data</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="c1">// 返回自身</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
</code></pre></div>
<p>后缀：哑元参数int</p>
<p>先构造一个原来的，返回++之前的。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Test</span> <span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="n">Test</span> <span class="nf">test</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span>    <span class="o">++</span><span class="n">data</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">return</span> <span class="n">test</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="22-operator">2.2 operator[]</h3>
<p>可用于“字典”/map。</p>
<p>如果返回类型是引用，则数组运算符调用可以出现在等号左边，接受赋值，即
    Obj[index] = value;
如果返回类型不是引用，则只能出现在等号右边
    Var = Obj[index];</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kt">char</span> <span class="n">week_name</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>    <span class="s">&quot;mon&quot;</span><span class="p">,</span> <span class="s">&quot;tu&quot;</span><span class="p">,</span> <span class="s">&quot;wed&quot;</span><span class="p">,</span> 
<span class="linenos" data-linenos=" 2 "></span>                                <span class="s">&quot;thu&quot;</span><span class="p">,</span> <span class="s">&quot;fri&quot;</span><span class="p">,</span> <span class="s">&quot;sat&quot;</span><span class="p">,</span> <span class="s">&quot;sun&quot;</span><span class="p">};</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">class</span> <span class="nc">WeekTemp</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="kt">int</span> <span class="n">temp</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="kt">int</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[]</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">)</span> <span class="c1">// 字符串作下标</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>      <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>            <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">week_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> 
<span class="linenos" data-linenos="13 "></span>                    <span class="k">return</span> <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos" data-linenos="14 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span><span class="p">};</span>
</code></pre></div>
<h3 id="23-operator">2.3 operator&lt;&lt;</h3>
<p>为什么重载流运算符要返回引用？避免复制。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">friend</span> <span class="n">istream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">istream</span><span class="o">&amp;</span> <span class="n">in</span><span class="p">,</span> <span class="n">Test</span><span class="o">&amp;</span> <span class="n">dst</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>        <span class="n">in</span> <span class="o">&gt;&gt;</span> <span class="n">dst</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="k">return</span> <span class="n">in</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">friend</span> <span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="n">Test</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">)</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">id</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">obj</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">obj</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<p><strong>需要使用友元函数</strong>。因为成员函数有一个隐藏的参数this。而流操作符左边必须是流类型。友元函数就没有那个this，满足了要求。</p>
<h3 id="24">2.4 友元与友元类</h3>
<p>友元不继承！</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">Y</span> <span class="p">{};</span> <span class="c1">// Y能访问A的所有成员</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>  <span class="c1">// 私有数据成员</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">enum</span> <span class="p">{</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">100</span> <span class="p">};</span>  <span class="c1">// 私有枚举项</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">friend</span> <span class="k">class</span> <span class="nc">X</span><span class="p">;</span>  <span class="c1">// 友元类前置声明（详细类型指定符）</span>
<span class="linenos" data-linenos="6 "></span>    <span class="k">friend</span> <span class="n">Y</span><span class="p">;</span>  <span class="c1">// 友元类声明（简单类型指定符） (C++11起)</span>
<span class="linenos" data-linenos="7 "></span><span class="p">};</span> 
<span class="linenos" data-linenos="8 "></span><span class="k">class</span> <span class="nc">X</span> <span class="p">{};</span> <span class="c1">// X能访问A的所有成员</span>
</code></pre></div>
<h3 id="25-static">2.5 静态 static</h3>
<p>静态变量：使用static修饰的变量
定义示例：static int i = 1;
初始化：初次定义时需要初始化，且只能初始化一次。如果定义时不初始化，则编译器会自动赋值为0
<strong>静态局部变量</strong>存储在静态存储区，生命周期将持续到<strong>整个程序结束</strong>
<strong>静态全局变量</strong>的作用域<strong>仅限其声明的文件</strong>，不能被其他文件所用，<u>可以避免和其他文件中的同名变量冲突</u>
静态函数：使用static修饰的函数
定义示例：static int func() {…}
<strong>静态函数</strong>的作用域<strong>仅限其声明的文件</strong>，不能被其他文件所用，可以避免和其他文件中的同名函数冲突</p>
<h4 id="251">2.5.1 静态数据成员（静态成员变量）（“类变量”）</h4>
<p>属于整个类；被该类的所有对象共享</p>
<p>在类实例化对象前已分配内存空间</p>
<p><strong><u>静态数据成员应该在.h文件中声明，在.cpp文件中定义。</u></strong></p>
<p>如果静态数据成员在.h文件中同时完成声明和定义，链接将无法进行。因为可能头文件被包含了多次，从而出现重复定义。</p>
<p>test.h：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">Test</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="4 "></span>  <span class="k">static</span> <span class="kt">int</span> <span class="n">count</span><span class="p">;</span> <span class="c1">//声明静态数据成员；对类实例计数用</span>
<span class="linenos" data-linenos="5 "></span>  <span class="n">Test</span><span class="p">();</span>
<span class="linenos" data-linenos="6 "></span>  <span class="o">~</span><span class="n">Test</span><span class="p">();</span>
<span class="linenos" data-linenos="7 "></span><span class="p">};</span>
</code></pre></div>
<p>test.cpp：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">#include “Test.h”</span>
<span class="linenos" data-linenos="2 "></span><span class="kt">int</span> <span class="n">Test</span><span class="o">::</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    <span class="c1">//定义静态数据成员（要加上类型）</span>
<span class="linenos" data-linenos="3 "></span><span class="n">Test</span><span class="o">::</span><span class="n">Test</span><span class="p">()</span> <span class="p">{</span> <span class="n">count</span> <span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="4 "></span><span class="n">Test</span><span class="o">::~</span><span class="n">Test</span><span class="p">()</span> <span class="p">{</span> <span class="n">count</span> <span class="o">--</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div>
<p>main.cpp：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos="2 "></span><span class="cp">#include “Test.h”</span>
<span class="linenos" data-linenos="3 "></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="6 "></span>  <span class="n">Test</span> <span class="n">t1</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="linenos" data-linenos="7 "></span>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="err">“</span><span class="n">Test</span><span class="err">#</span><span class="o">:</span> <span class="err">”</span> <span class="o">&lt;&lt;</span> <span class="n">Test</span><span class="o">::</span><span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="err">“</span> <span class="n">or</span> <span class="err">”</span> <span class="o">&lt;&lt;</span> <span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span>  <span class="c1">//通过类名或对象（实例）访问静态数据成员</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="252">2.5.2 静态成员函数</h4>
<p>在类实例化对象前分配内存空间</p>
<p>不能访问非静态成员，否则相当于使用没有初始化的变量</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">static</span> <span class="kt">int</span> <span class="n">how_many</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">count</span><span class="p">;</span> <span class="p">}</span> 
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">Test</span><span class="o">::</span><span class="n">how_many</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<h3 id="26">2.6 引用</h3>
<h4 id="261">2.6.1 引用传参不构造也不析构</h4>
<p>类成员里有指针时最好这样，避免函数结束时delete了形参里的指针。</p>
<h4 id="262">2.6.2 引用不能改指向</h4>
<h3 id="27">2.7 拷贝构造函数</h3>
<p>参数是语言规定的，是同类对象的常量引用</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>MyClass(const MyClass&amp; src) {}
</code></pre></div>
<p>如果没有显式定义，则自动合成，采用~~位拷贝(Bitcopy)~~，即直接使用赋值运算符拷贝类的所有数据成员。</p>
<p>被调用的三种常见情况：</p>
<p>1、用一个类对象定义另一个新的类对象</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Test</span> <span class="n">a</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">Test</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="c1">// 并不是调用重载的等号！！而是用的拷贝构造函数！</span>
<span class="linenos" data-linenos="3 "></span><span class="n">Test</span> <span class="nf">b</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</code></pre></div>
<p>2、函数调用时以类的对象为形参</p>
<p>函数调用，形参传参</p>
<p><code>Func(Test a)</code></p>
<p>3、函数返回类对象</p>
<p><code>Test Func(void)</code></p>
<p>返回值时构造临时对象</p>
<p><code>MyClass res = f(a)</code></p>
<p>没有RVO时，返回值先给临时变量，临时变量再给<code>res</code>。</p>
<p>禁止RVO的编译选项：<code>-fno-elide-constructors</code></p>
<h3 id="28">2.8 右值引用</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">int</span> <span class="o">&amp;&amp;</span><span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="kt">int</span> <span class="o">&amp;&amp;</span><span class="n">j</span> <span class="o">=</span> <span class="n">lvalue</span><span class="p">;</span>   <span class="c1">// NOT allowed</span>
</code></pre></div>
<p>左值引用能绑定左值，右值引用能绑定右值。</p>
<p>常量左值引用能也绑定右值。<code>const int &amp;e = 3;</code></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">void</span> <span class="nf">ref</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;&amp;</span><span class="n">x</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;right &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span>
<span class="linenos" data-linenos="5 "></span><span class="n">ref</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</code></pre></div>
<p>混淆：右值引用本身为左值。</p>
<h3 id="29">2.9 移动构造函数</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Test</span><span class="p">(</span><span class="n">Test</span><span class="o">&amp;&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="o">:</span> <span class="n">buf</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">buf</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span> <span class="c1">//直接复制地址，避免拷贝</span>
<span class="linenos" data-linenos="3 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Test(Test&amp;&amp;) called. this-&gt;buf @ &quot;</span>
<span class="linenos" data-linenos="4 "></span>            <span class="o">&lt;&lt;</span> <span class="n">hex</span> <span class="o">&lt;&lt;</span> <span class="n">buf</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>        <span class="n">t</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span> <span class="c1">// 将t.buf改为nullptr，使其不再指向原来内存区域</span>
<span class="linenos" data-linenos="6 "></span>        <span class="c1">// 这之后t就用不了了；它的地址现在被拷贝目标对象所有</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div>
<p>禁止RVO时，返回值先移动给临时变量，再移动给目标对象。</p>
<p><code>std::move</code>：将左值转化为右值</p>
<p>move函数本身不对对象做任何操作，仅做类型转换，即转换为右值。<strong>移动的具体操作在移动构造函数内实现。</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">Test</span> <span class="n">y</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">f</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">z</span><span class="p">));</span>    <span class="c1">// 调用f的移动构造函数传参版本</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">// 性能更好的swap函数</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">swap</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">{</span> 
<span class="linenos" data-linenos=" 7 "></span>     <span class="n">T</span> <span class="nf">tmp</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
<span class="linenos" data-linenos=" 8 "></span>     <span class="n">a</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>     <span class="n">b</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="210">2.10 拷贝赋值运算符</h3>
<p>赋值重载函数必须要是类的非静态成员函数(non-static member function)，<strong>不能是友元函数</strong>。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">MyClass</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">MyClass</span><span class="o">&amp;</span> <span class="n">right</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>   <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span>   <span class="p">{</span>    <span class="c1">// 避免自己赋值给自己</span>
<span class="linenos" data-linenos="5 "></span>            <span class="c1">// 将right对象中的内容拷贝到当前对象中...</span>
<span class="linenos" data-linenos="6 "></span>     <span class="p">}</span>
<span class="linenos" data-linenos="7 "></span>   <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>    <span class="c1">// 返回当前对象</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
<p>注意区分下面两种代码：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1">// 已经定义的对象之间相互赋值，调用拷贝赋值运算符</span>
<span class="linenos" data-linenos="2 "></span><span class="n">ClassName</span> <span class="n">a</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="n">ClassName</span> <span class="n">b</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="c1">// a未定义；用b初始化a</span>
<span class="linenos" data-linenos="6 "></span><span class="n">ClassName</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</code></pre></div>
<h3 id="211">2.11 移动赋值运算符</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">Test</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span> <span class="p">(</span><span class="n">Test</span><span class="o">&amp;&amp;</span> <span class="n">right</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span> <span class="c1">// 避免自己给自己（无用操作）</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;same obj!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">else</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">{</span>   
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">this</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">=</span> <span class="n">right</span><span class="p">.</span><span class="n">buf</span><span class="p">;</span>  <span class="c1">// 直接赋值地址</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="n">right</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>    <span class="c1">// 原来的置空</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;operator=(Test&amp;&amp;) called.</span><span class="se">\n</span><span class="s">“;</span>
<span class="linenos" data-linenos="10 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="212">2.12 自动类型转换</h3>
<p>一下两种方法必须恰好用一种。</p>
<h4 id="2121">2.12.1 目标类型转换运算符</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// Src -&gt; Dst 的转换</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Src</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">operator</span> <span class="n">Dst</span><span class="p">()</span> <span class="k">const</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">{</span> <span class="c1">// 返回值类型是Dst；在convert function中必须省略不写</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="n">Dst</span> <span class="n">ret</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="c1">// ...</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="213">2.13 构造函数转换法</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">Src</span><span class="p">;</span>  <span class="c1">// 前置类型声明，因为在Dst中要用到Src类</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">Dst</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="5 "></span>  <span class="n">Dst</span><span class="p">(</span><span class="k">const</span> <span class="n">Src</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos" data-linenos="6 "></span>  <span class="p">{</span> 
<span class="linenos" data-linenos="7 "></span>        <span class="c1">// cout &lt;&lt; &quot;Dst::Dst(const Src&amp;)&quot; &lt;&lt; endl; </span>
<span class="linenos" data-linenos="8 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="9 "></span><span class="p">};</span>
</code></pre></div>
<h4 id="2131">2.13.1 禁止自动类型转换</h4>
<p>如果用explicit修饰类型转换运算符或类型转换构造函数，则相应的类型转换必须显式地进行。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">explicit</span> <span class="k">operator</span> <span class="n">Dst</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="k">explicit</span> <span class="nf">Dst</span><span class="p">(</span><span class="k">const</span> <span class="n">Src</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="n">Dst</span> <span class="nf">d1</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>  <span class="c1">//可以执行，被认为是显式初始化</span>
</code></pre></div>
<h3 id="214">2.14 强制类型转换</h3>
<p>const_cast，去除类型的const或volatile属性。
static_cast，类似于C风格的强制转换。无条件转换，静态类型转换。
dynamic_cast，动态类型转换，如<strong>派生类和基类之间</strong>的多态类型转换。
reinterpret_cast，仅仅重新解释类型，但没有进行二进制的转换。</p>
<p>如：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Dst</span> <span class="n">d2</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Dst</span><span class="o">&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</code></pre></div>
<h3 id="215">2.15 类的组合</h3>
<p>构造顺序：先完成子对象构造，再完成当前对象构造</p>
<p>析构顺序：与构造顺序相反</p>
<h3 id="216">2.16 类的继承</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">Child</span> <span class="o">:</span> <span class="n">Father</span> <span class="p">{};</span>    <span class="c1">// 默认为private继承</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">Child</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Father</span> <span class="p">{};</span>
<span class="linenos" data-linenos="3 "></span><span class="k">class</span> <span class="nc">Child</span> <span class="o">:</span> <span class="k">protected</span> <span class="n">Father</span> <span class="p">{};</span>  <span class="c1">// 很少被使用</span>
</code></pre></div>
<p>构造函数、析构函数、友元函数、赋值运算符不被继承！</p>
<p>子类若想要显式调用父类构造函数，则只能在子类构造函数的<strong>初始化成员列表</strong>中进行。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Derive</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">Base</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{};</span>
</code></pre></div>
<p>继承父类构造函数</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Base</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">data</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{};</span>
<span class="linenos" data-linenos="2 "></span><span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">Base</span><span class="p">;</span>       <span class="c1">///相当于 Derive(int i):Base(i) {};</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1">// 当父类有多个构造函数时，一句using可以自动构造相应的多个</span>
</code></pre></div>
<h3 id="217-redefining">2.17 重写隐藏 redefining</h3>
<p>目的：在派生类中重新定义基类函数，实现派生类的特殊功能。
屏蔽了基类的所有其它同名函数。
<strong>函数名必须相同，函数参数可以不同</strong></p>
<p>相当于重新定义父类同名函数。一般不涉及虚函数。</p>
<p>可以在派生类中通过using 类名::成员函数名; 在派生类中“恢复”指定的基类成员函数（即去掉屏蔽），使之重新可用。</p>
<h3 id="218">2.18 向上类型转换</h3>
<p>只对public继承有效，在继承图上是上升的；对private、protected继承无效。</p>
<h3 id="219">2.19 虚函数</h3>
<p>通过基类<strong>指针或引用</strong>调用该成员函数时……</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">virtual</span> <span class="kt">int</span> <span class="n">func</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">);</span>
</code></pre></div>
<p>协变：派生类（子类）虚函数的返回类型和基类（父类）相同</p>
<p>实现原理：虚函数表。在构造函数的开头插入了初始化VPTR的代码。</p>
<p>构造函数不能是虚函数。在构造函数中调用一个虚函数，被调用的只是这个函数的本地版本，即虚机制在构造函数中不工作。</p>
<p><strong>析构函数往往是虚函数。</strong>虚机制在析构函数中也不工作。</p>
<p><u><strong>重要原则：</strong></u>
<u><strong>总是将基类的析构函数设置为虚析构函数</strong></u></p>
<h3 id="220-override">2.20 重写覆盖 override</h3>
<p>子类重新定义父类中的虚函数，<strong>函数名必须相同，函数参数必须相同，返回值一般情况应相同</strong>。</p>
<p>屏蔽了父类中的同名函数。</p>
<p>程序运行时才知道。晚捆绑（只对虚函数起作用）。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1">// in Father</span>
<span class="linenos" data-linenos="2 "></span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{}</span>
<span class="linenos" data-linenos="3 "></span><span class="c1">// in Child</span>
<span class="linenos" data-linenos="4 "></span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="k">override</span> <span class="p">{}</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="c1">// final 关键字可以让虚函数不能被后续子类override</span>
<span class="linenos" data-linenos="7 "></span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="k">final</span> <span class="p">{}</span>
</code></pre></div>
<p>使用const修饰成员函数，可能导致重写覆盖失效</p>
<h3 id="221">2.21 抽象类与纯虚函数</h3>
<p>纯虚函数的声明：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">virtual</span> <span class="kt">int</span> <span class="n">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// 在类外定义函数，提供实现</span>
<span class="linenos" data-linenos="3 "></span><span class="kt">int</span> <span class="n">MyClass</span><span class="o">::</span><span class="n">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div>
<p>包含纯虚函数的类就是<strong>抽象类</strong>。作用时提供接口。</p>
<p>抽象类不能定义对象！！（即不能实例化。）</p>
<p>纯虚函数被override之前还是纯虚函数。</p>
<p>如果一个抽象类的纯虚函数没有被全部实现（除了纯虚析构函数），则其子类还是抽象类，还是不能实例化。</p>
<p><strong>纯虚析构函数</strong>仍然需要函数体。
目的：使基类成为抽象类，不能创建基类的对象。如果有其他函数是纯虚函数，则析构函数不必是纯虚的。</p>
<h3 id="222-dynamic_cast">2.22 向下类型转换 dynamic_cast</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">SrcClass</span><span class="o">*</span> <span class="n">p1</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">TargetClass</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">TargetClass</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="n">Father</span><span class="o">*</span> <span class="n">p1</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="n">Child</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Child</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>
</code></pre></div>
<h3 id="223-template">2.23 模板 template</h3>
<p>模板参数必须在编译期确定。因此不能为变量，只能是常量。静多态。</p>
<p>函数模板</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="c1">// template &lt;class T&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">T</span> <span class="n">sum</span><span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="c1">// 指定调用类型</span>
<span class="linenos" data-linenos="8 "></span><span class="n">sum</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">);</span>
</code></pre></div>
<p>类模板</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">A</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>  <span class="n">T</span> <span class="n">data</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 6 "></span>  <span class="kt">void</span> <span class="n">print</span><span class="p">();</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="n">T1</span> <span class="n">get</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span><span class="p">};</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">//类外定义类模板中的成员函数</span>
<span class="linenos" data-linenos="12 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="kt">void</span> <span class="n">A</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">print</span><span class="p">()</span> <span class="p">{}</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="c1">// “双重模板”</span>
<span class="linenos" data-linenos="16 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="o">&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="n">T1</span> <span class="n">A</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">get</span><span class="p">()</span> <span class="p">{}</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="n">A</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">;</span>
</code></pre></div>
<p>类模板的模板参数</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span><span class="o">&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="k">class</span> <span class="nc">Array</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>  <span class="n">T</span> <span class="n">data</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
<span class="linenos" data-linenos="5 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="6 "></span>  <span class="kt">void</span> <span class="n">print</span><span class="p">();</span>
<span class="linenos" data-linenos="7 "></span><span class="p">};</span>
<span class="linenos" data-linenos="8 "></span>
<span class="linenos" data-linenos="9 "></span><span class="n">A</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">10</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">;</span>
</code></pre></div>
<h4 id="2231">2.23.1 传递数组作为函数参数</h4>
<p>普通数组；把大小作为模板参数n；注意符号“&amp;”。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">A</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="o">&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="kt">void</span> <span class="n">work</span><span class="p">(</span><span class="k">const</span> <span class="n">A</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">_array</span><span class="p">)[</span><span class="n">n</span><span class="p">])</span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
<span class="linenos" data-linenos="6 "></span><span class="c1">// call the function</span>
<span class="linenos" data-linenos="7 "></span><span class="kt">double</span> <span class="n">arr</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">};</span>
<span class="linenos" data-linenos="8 "></span><span class="n">work</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span>
</code></pre></div>
<h3 id="224-thread">2.24 多线程 thread</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kt">void</span> <span class="nf">test</span><span class="p">(</span><span class="kt">int</span> <span class="n">seconds</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>  <span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="n">seconds</span><span class="p">));</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="kr">thread</span> <span class="n">t_nothing</span><span class="p">;</span> <span class="c1">// 创建一个空thread</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="kr">thread</span> <span class="n">t1</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>   <span class="c1">// 创建一个thread</span>
<span class="linenos" data-linenos="10 "></span>  <span class="kr">thread</span> <span class="n">t2</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>  <span class="c1">// thread 创建之后到销毁之前，必须决定join还是detach</span>
<span class="linenos" data-linenos="12 "></span>  <span class="n">t1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>  <span class="n">t2</span><span class="p">.</span><span class="n">detach</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>  <span class="c1">// 功能性接口</span>
<span class="linenos" data-linenos="16 "></span>  <span class="n">this_thread</span><span class="o">::</span><span class="n">get_id</span><span class="p">();</span>
<span class="linenos" data-linenos="17 "></span>  <span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span>  <span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_until</span><span class="p">();</span>
<span class="linenos" data-linenos="19 "></span>  <span class="n">this_thread</span><span class="o">::</span><span class="n">yield</span><span class="p">();</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="225">2.25 主从模式</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 2 "></span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 3 "></span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 4 "></span><span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="kr">thread</span><span class="o">*</span> <span class="n">threads</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="c1">// 线程指针</span>
<span class="linenos" data-linenos=" 8 "></span><span class="kt">int</span> <span class="n">thread_total</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>    <span class="c1">//每个线程的计数器</span>
<span class="linenos" data-linenos=" 9 "></span><span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">mx</span><span class="p">;</span>  <span class="c1">//总计数器</span>
<span class="linenos" data-linenos="10 "></span><span class="kt">bool</span> <span class="nf">check_num</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>   <span class="c1">//枚举是否为素数</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="c1">//统计[l,r)之间的素数个数</span>
<span class="linenos" data-linenos="13 "></span><span class="c1">//存入thread_total[num]中</span>
<span class="linenos" data-linenos="14 "></span><span class="kt">void</span> <span class="nf">check</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span> 
<span class="linenos" data-linenos="15 "></span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>  <span class="n">thread_total</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">if</span> <span class="p">(</span><span class="n">check_num</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="linenos" data-linenos="19 "></span>      <span class="n">thread_total</span><span class="p">[</span><span class="n">num</span><span class="p">]</span><span class="o">++</span><span class="p">;</span> 
<span class="linenos" data-linenos="20 "></span><span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="linenos" data-linenos="23 "></span><span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>  <span class="n">mi</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos="26 "></span>  <span class="p">{</span> <span class="c1">// 用循环创建线程</span>
<span class="linenos" data-linenos="27 "></span>    <span class="n">mx</span> <span class="o">=</span> <span class="n">mi</span> <span class="o">+</span> <span class="mi">5000000</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
<span class="linenos" data-linenos="28 "></span>    <span class="k">if</span> <span class="p">(</span><span class="n">mx</span> <span class="o">&gt;</span> <span class="mi">5000000</span><span class="p">)</span> <span class="n">mx</span> <span class="o">=</span> <span class="mi">5000000</span><span class="p">;</span>
<span class="linenos" data-linenos="29 "></span>    <span class="c1">//为第i个线程分配[mi,mx)区间的任务</span>
<span class="linenos" data-linenos="30 "></span>    <span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="kr">thread</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<span class="linenos" data-linenos="31 "></span>    <span class="n">mi</span> <span class="o">=</span> <span class="n">mx</span><span class="p">;</span> 
<span class="linenos" data-linenos="32 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="33 "></span>  <span class="c1">//阻塞主线程，等待所有子线程完成统计</span>
<span class="linenos" data-linenos="34 "></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos="35 "></span>    <span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">join</span><span class="p">();</span>
<span class="linenos" data-linenos="36 "></span>  <span class="c1">//汇总子线程的统计结果，释放thread实例</span>
<span class="linenos" data-linenos="37 "></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="38 "></span>    <span class="n">total</span> <span class="o">+=</span> <span class="n">thread_total</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos" data-linenos="39 "></span>    <span class="k">delete</span> <span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos" data-linenos="40 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="41 "></span>  <span class="c1">//输出</span>
<span class="linenos" data-linenos="42 "></span>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="43 "></span>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="linenos" data-linenos="44 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="226-mutex">2.26 互斥锁模式 mutex</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">static</span> <span class="n">mutex</span> <span class="n">exclusive</span><span class="p">;</span> <span class="c1">// 互斥量</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kt">void</span> <span class="nf">check_range</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>  <span class="kt">int</span> <span class="n">tmp_total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">if</span> <span class="p">(</span><span class="n">check_num</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="linenos" data-linenos=" 7 "></span>      <span class="n">tmp_total</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="n">exclusive</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span> <span class="c1">//加锁</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="n">total</span><span class="o">+=</span><span class="n">tmp_total</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>  <span class="n">exclusive</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span> <span class="c1">//解锁</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="227-async-future">2.27 异步 async future</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">#include</span> <span class="cpf">&lt;future&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 2 "></span><span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="kt">int</span> <span class="nf">worker</span><span class="p">(</span><span class="kt">int</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>   <span class="c1">// 返回int值的一个工作函数</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="n">future</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">fut</span> <span class="o">=</span> <span class="n">async</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="mi">403</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="c1">// auto fut = async(worker, 403);</span>
<span class="linenos" data-linenos="10 "></span>  <span class="c1">// future的接口</span>
<span class="linenos" data-linenos="11 "></span>  <span class="n">fut</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>   <span class="c1">// 阻塞当前线程，等待异步线程结束</span>
<span class="linenos" data-linenos="12 "></span>  <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">fut</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>  <span class="c1">// get运行结果；一个future只能被get一次</span>
<span class="linenos" data-linenos="13 "></span>  <span class="n">fut</span><span class="p">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>  <span class="c1">// 超时后返回一个future_status，并取消对当前线程的阻塞</span>
<span class="linenos" data-linenos="14 "></span>  <span class="cm">/*</span>
<span class="linenos" data-linenos="15 "></span><span class="cm">    future_status::deferred 仍未启动</span>
<span class="linenos" data-linenos="16 "></span><span class="cm">    future_status::ready        结果就绪</span>
<span class="linenos" data-linenos="17 "></span><span class="cm">    future_status::timeout  已超过时限，异步线程仍在执行</span>
<span class="linenos" data-linenos="18 "></span><span class="cm">  */</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="2271">2.27.1 轮询</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kt">int</span> <span class="nf">worker</span><span class="p">(</span><span class="kt">int</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>   <span class="c1">// 返回int值的一个工作函数</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kt">int</span> <span class="nf">input</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">future_lists</span><span class="p">;</span>   <span class="c1">// 异步线程对象表</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">num_lists</span><span class="p">;</span>  <span class="c1">// 输入数据表</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="k">while</span> <span class="p">(</span><span class="n">ture</span><span class="p">)</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>    <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">input</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span>    <span class="c1">//创建异步线程</span>
<span class="linenos" data-linenos="12 "></span>        <span class="n">future_lists</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">async</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="n">num</span><span class="p">));</span>
<span class="linenos" data-linenos="13 "></span>    <span class="n">num_lists</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>    <span class="n">res_lists</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span>    <span class="c1">//通过future检测每一个异步线程是否完成</span>
<span class="linenos" data-linenos="17 "></span>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">future_lists</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="19 "></span>        <span class="c1">//每个future等待0.1秒来检测状态</span>
<span class="linenos" data-linenos="20 "></span>        <span class="n">future_status</span> <span class="n">status</span> <span class="o">=</span> <span class="n">future_lists</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">wait_for</span><span class="p">(</span>
<span class="linenos" data-linenos="21 "></span>         <span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<span class="linenos" data-linenos="22 "></span>        <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">future_status</span><span class="o">::</span><span class="n">ready</span><span class="p">)</span> <span class="c1">// 已经得到了结果</span>
<span class="linenos" data-linenos="23 "></span>      <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>        <span class="c1">// 输出结果</span>
<span class="linenos" data-linenos="25 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">num_lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">future_lists</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="26 "></span>        <span class="c1">//删除已经完成任务的future</span>
<span class="linenos" data-linenos="27 "></span>        <span class="n">future_lists</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">future_lists</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
<span class="linenos" data-linenos="28 "></span>        <span class="n">num_lists</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">num_lists</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
<span class="linenos" data-linenos="29 "></span>      <span class="p">}</span>
<span class="linenos" data-linenos="30 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="31 "></span>
<span class="linenos" data-linenos="32 "></span>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="33 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="228-promise">2.28 promise</h3>
<h3 id="229">2.29 函数指针</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">double</span> <span class="nf">work</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// [返回值] (*[声明的变量名])([参数类型列表])</span>
<span class="linenos" data-linenos="3 "></span><span class="kt">double</span> <span class="p">(</span><span class="o">*</span><span class="n">fp</span><span class="p">)(</span><span class="kt">int</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="n">work</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="c1">// 自动推导</span>
<span class="linenos" data-linenos="5 "></span><span class="k">auto</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">work</span><span class="p">;</span>
</code></pre></div>
<h3 id="230">2.30 函数对象</h3>
<p>类的对象，用起来像函数，看做函数对象。末尾带括号。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// 仿照greater&lt;int&gt;()实现函数对象</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">class</span> <span class="nc">Greater</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="k">const</span>
<span class="linenos" data-linenos=" 7 "></span>  <span class="p">{</span> <span class="c1">// 重载()；用于排序的cmp函数的特点：三个const</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="p">};</span>
<span class="linenos" data-linenos="11 "></span><span class="n">Greater</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">()(</span><span class="mf">4.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</code></pre></div>
<h3 id="231-function">2.31 function 类</h3>
<p>function为函数指针与对象提供了统一的接口</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// function&lt;[返回值](参数列表)&gt; func = f;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">f1</span><span class="p">,</span> <span class="n">function</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">f2</span><span class="p">)</span> <span class="p">{}</span>
<span class="linenos" data-linenos=" 3 "></span><span class="kt">int</span> <span class="nf">work1</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">class</span> <span class="nc">Work2</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span> <span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 7 "></span>  <span class="kt">double</span> <span class="k">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="n">process</span><span class="p">(</span><span class="n">work1</span><span class="p">,</span> <span class="n">Work2</span><span class="p">());</span>
</code></pre></div>
<h3 id="232">2.32 智能指针</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"></span>
</code></pre></div>
<h4 id="2321-unique_ptr">2.32.1 unique_ptr</h4>
<p>独占。同一时间内只有一个智能指针可以指向该对象。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">p3</span> <span class="p">(</span><span class="k">new</span> <span class="n">string</span> <span class="p">(</span><span class="s">&quot;auto&quot;</span><span class="p">));</span>
<span class="linenos" data-linenos="2 "></span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">p4</span><span class="err">；</span>  
<span class="linenos" data-linenos="3 "></span><span class="c1">// 不能再 p4 = p3;</span>
<span class="linenos" data-linenos="4 "></span><span class="c1">// 这样new完之后就不需要记得去delete了，避免了内存泄漏</span>
</code></pre></div>
<h4 id="2322-shared_ptr">2.32.2 shared_ptr</h4>
<p>共享。计数。多个智能指针可以指向相同对象，该对象和其相关<u>资源会在“最后一个引用被销毁”时候释放</u>。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// 不能使用同一裸指针初始化多个智能指针</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kt">int</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">();</span> 
<span class="linenos" data-linenos=" 3 "></span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p1</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p2</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>  <span class="c1">// 会产生多个辅助指针！</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">sp</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">string</span> <span class="o">*</span><span class="n">s1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="s">&quot;s1&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">sp1</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">sp2</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="n">sp2</span> <span class="o">=</span> <span class="n">sp1</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sp1</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span> <span class="c1">//查看引用计数</span>
<span class="linenos" data-linenos="14 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sp2</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sp1</span><span class="p">.</span><span class="n">unique</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>   <span class="c1">// 是否独占</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sp1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>    <span class="c1">// sp1代表的指针</span>
<span class="linenos" data-linenos="18 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sp1</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>  <span class="c1">// 同上</span>
<span class="linenos" data-linenos="19 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sp1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>    <span class="c1">// &quot;s1&quot;；相当于*(sp1代表的指针)，是指针指向的对象</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span><span class="n">sp1</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>    <span class="c1">// 清除指针并减少引用计数</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span><span class="c1">// 智能指针的向下转换</span>
<span class="linenos" data-linenos="24 "></span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span><span class="n">Child</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</code></pre></div>
<h4 id="2323-weak_ptr">2.32.3 weak_ptr 弱引用</h4>
<p>指向对象，但不增加引用计数。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">sp</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="linenos" data-linenos="2 "></span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">wp1</span> <span class="o">=</span> <span class="n">sp</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="n">wp</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span>  <span class="c1">//获取引用计数</span>
<span class="linenos" data-linenos="5 "></span><span class="n">wp</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>          <span class="c1">//清除指针</span>
<span class="linenos" data-linenos="6 "></span><span class="n">wp</span><span class="p">.</span><span class="n">expired</span><span class="p">()</span>        <span class="c1">//检查对象是否无效</span>
<span class="linenos" data-linenos="7 "></span><span class="n">sp</span> <span class="o">=</span> <span class="n">wp</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span>  <span class="c1">//从弱引用获得一个智能指针</span>
</code></pre></div>
<h3 id="233-lambda">2.33 Lambda 函数</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">[</span><span class="n">capture</span><span class="p">]</span> <span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="k">mutable</span> <span class="o">-&gt;</span> <span class="k">return</span><span class="o">-</span><span class="n">type</span> <span class="p">{</span><span class="n">statement</span><span class="p">}</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="p">[](</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;}</span> <span class="c1">// 判断x是否是偶数</span>
</code></pre></div>
<h3 id="234">2.34 行为型模式</h3>
<p>能以最少的代码变动完成功能的增减</p>
<h4 id="2341">2.34.1 迭代器模式</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="  1 "></span><span class="c1">//迭代器基类</span>
<span class="linenos" data-linenos="  2 "></span><span class="k">class</span> <span class="nc">Iterator</span> <span class="p">{</span>
<span class="linenos" data-linenos="  3 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="  4 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Iterator</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="  5 "></span>    <span class="k">virtual</span> <span class="n">Iterator</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="  6 "></span>    <span class="k">virtual</span> <span class="kt">float</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="  7 "></span>    <span class="k">virtual</span> <span class="kt">float</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="  8 "></span>    <span class="k">virtual</span> <span class="kt">float</span><span class="o">*</span> <span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="  9 "></span>    <span class="k">virtual</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Iterator</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 10 "></span>    <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Iterator</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
<span class="linenos" data-linenos=" 11 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 12 "></span>        <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="k">this</span> <span class="o">!=</span> <span class="n">other</span><span class="p">);</span>
<span class="linenos" data-linenos=" 13 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 14 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 15 "></span>
<span class="linenos" data-linenos=" 16 "></span><span class="k">class</span> <span class="nc">Collection</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 17 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 18 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Collection</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 19 "></span>    <span class="k">virtual</span> <span class="n">Iterator</span><span class="o">*</span> <span class="n">begin</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 20 "></span>    <span class="k">virtual</span> <span class="n">Iterator</span><span class="o">*</span> <span class="n">end</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 21 "></span>    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">size</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 22 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 23 "></span>
<span class="linenos" data-linenos=" 24 "></span><span class="c1">//继承自迭代器基类并配套ArrayCollection使用的迭代器</span>
<span class="linenos" data-linenos=" 25 "></span><span class="k">class</span> <span class="nc">ArrayIterator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Iterator</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 26 "></span>    <span class="kt">float</span> <span class="o">*</span><span class="n">_data</span><span class="p">;</span>   <span class="c1">//ArrayCollection的数据</span>
<span class="linenos" data-linenos=" 27 "></span>    <span class="kt">int</span> <span class="n">_index</span><span class="p">;</span>     <span class="c1">//数据访问到的下标</span>
<span class="linenos" data-linenos=" 28 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 29 "></span>    <span class="n">ArrayIterator</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="o">:</span>
<span class="linenos" data-linenos=" 30 "></span>            <span class="n">_data</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 31 "></span>    <span class="n">ArrayIterator</span><span class="p">(</span><span class="k">const</span> <span class="n">ArrayIterator</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="o">:</span>
<span class="linenos" data-linenos=" 32 "></span>            <span class="n">_data</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">_data</span><span class="p">),</span> <span class="n">_index</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">_index</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 33 "></span>    <span class="o">~</span><span class="n">ArrayIterator</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 34 "></span>    <span class="n">Iterator</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">()</span>
<span class="linenos" data-linenos=" 35 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 36 "></span>        <span class="n">_index</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos=" 37 "></span>        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="linenos" data-linenos=" 38 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 39 "></span>    <span class="cm">/*</span>
<span class="linenos" data-linenos=" 40 "></span><span class="cm">    Iterator operator++(int)</span>
<span class="linenos" data-linenos=" 41 "></span><span class="cm">    {</span>
<span class="linenos" data-linenos=" 42 "></span><span class="cm">        ArrayIterator ret(*this);</span>
<span class="linenos" data-linenos=" 43 "></span><span class="cm">        _index++;</span>
<span class="linenos" data-linenos=" 44 "></span><span class="cm">        return ret;</span>
<span class="linenos" data-linenos=" 45 "></span><span class="cm">    }</span>
<span class="linenos" data-linenos=" 46 "></span><span class="cm">    */</span>
<span class="linenos" data-linenos=" 47 "></span>    <span class="kt">float</span><span class="o">&amp;</span> <span class="n">ArrayIterator</span><span class="o">::</span><span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 48 "></span>        <span class="n">_index</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos=" 49 "></span>        <span class="k">return</span> <span class="n">_data</span><span class="p">[</span><span class="n">_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
<span class="linenos" data-linenos=" 50 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 51 "></span>
<span class="linenos" data-linenos=" 52 "></span>    <span class="kt">float</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span><span class="p">()</span>  <span class="c1">//对data的内存位置取值</span>
<span class="linenos" data-linenos=" 53 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 54 "></span>        <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">_data</span> <span class="o">+</span> <span class="n">_index</span><span class="p">);</span>
<span class="linenos" data-linenos=" 55 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 56 "></span>    <span class="kt">float</span><span class="o">*</span> <span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span>
<span class="linenos" data-linenos=" 57 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 58 "></span>        <span class="k">return</span> <span class="p">(</span><span class="n">_data</span> <span class="o">+</span> <span class="n">_index</span><span class="p">);</span>
<span class="linenos" data-linenos=" 59 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 60 "></span>    <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Iterator</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>    <span class="c1">//判断是不是指向内存的同一位置</span>
<span class="linenos" data-linenos=" 61 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 62 "></span>        <span class="k">return</span> <span class="p">(</span><span class="n">_data</span> <span class="o">!=</span> <span class="p">((</span><span class="n">ArrayIterator</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">other</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">_data</span> <span class="o">||</span>
<span class="linenos" data-linenos=" 63 "></span>                <span class="n">_index</span> <span class="o">!=</span> <span class="p">((</span><span class="n">ArrayIterator</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">other</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">_index</span><span class="p">);</span>
<span class="linenos" data-linenos=" 64 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 65 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 66 "></span>
<span class="linenos" data-linenos=" 67 "></span><span class="k">class</span> <span class="nc">ArrayCollection</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Collection</span> <span class="p">{</span> <span class="c1">//底层为数组的存储结构类</span>
<span class="linenos" data-linenos=" 68 "></span>    <span class="k">friend</span> <span class="k">class</span> <span class="nc">ArrayIterator</span><span class="p">;</span> <span class="c1">//friend可以使得配套的迭代器类可以访问数据</span>
<span class="linenos" data-linenos=" 69 "></span>    <span class="kt">float</span><span class="o">*</span> <span class="n">_data</span><span class="p">;</span>
<span class="linenos" data-linenos=" 70 "></span>    <span class="kt">int</span> <span class="n">_size</span><span class="p">;</span>
<span class="linenos" data-linenos=" 71 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 72 "></span>    <span class="n">ArrayCollection</span><span class="p">()</span> <span class="o">:</span> <span class="n">_size</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos" data-linenos=" 73 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 74 "></span>        <span class="n">_data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">_size</span><span class="p">];</span>
<span class="linenos" data-linenos=" 75 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 76 "></span>    <span class="n">ArrayCollection</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">data</span><span class="p">)</span> <span class="o">:</span> <span class="n">_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="linenos" data-linenos=" 77 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 78 "></span>        <span class="n">_data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">_size</span><span class="p">];</span>       <span class="c1">//开辟数组空间用以存储数据</span>
<span class="linenos" data-linenos=" 79 "></span>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos=" 80 "></span>            <span class="o">*</span><span class="p">(</span><span class="n">_data</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
<span class="linenos" data-linenos=" 81 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 82 "></span>    <span class="o">~</span><span class="n">ArrayCollection</span><span class="p">()</span>
<span class="linenos" data-linenos=" 83 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 84 "></span>        <span class="k">delete</span><span class="p">[]</span> <span class="n">_data</span><span class="p">;</span>
<span class="linenos" data-linenos=" 85 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 86 "></span>    <span class="kt">int</span> <span class="n">size</span><span class="p">()</span>
<span class="linenos" data-linenos=" 87 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 88 "></span>        <span class="k">return</span> <span class="n">_size</span><span class="p">;</span>
<span class="linenos" data-linenos=" 89 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 90 "></span>    <span class="n">Iterator</span><span class="o">*</span> <span class="n">begin</span><span class="p">()</span> <span class="k">const</span> <span class="c1">//头迭代器，并放入相应数据</span>
<span class="linenos" data-linenos=" 91 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 92 "></span>        <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayIterator</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="linenos" data-linenos=" 93 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 94 "></span>    <span class="n">Iterator</span><span class="o">*</span> <span class="n">end</span><span class="p">()</span> <span class="k">const</span>   <span class="c1">//尾迭代器，并放入相应数据</span>
<span class="linenos" data-linenos=" 95 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 96 "></span>        <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayIterator</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">_size</span><span class="p">);</span>
<span class="linenos" data-linenos=" 97 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 98 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 99 "></span><span class="c1">// in main:</span>
<span class="linenos" data-linenos="100 "></span><span class="kt">float</span> <span class="n">scores</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span> <span class="p">};</span>
<span class="linenos" data-linenos="101 "></span><span class="n">Collection</span> <span class="o">*</span><span class="n">collection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayCollection</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">scores</span><span class="p">);</span>
<span class="linenos" data-linenos="102 "></span>
<span class="linenos" data-linenos="103 "></span><span class="n">Iterator</span><span class="o">*</span> <span class="n">begin</span> <span class="o">=</span> <span class="n">collection</span> <span class="o">-&gt;</span> <span class="n">begin</span><span class="p">();</span>
<span class="linenos" data-linenos="104 "></span><span class="n">Iterator</span><span class="o">*</span> <span class="n">end</span> <span class="o">=</span> <span class="n">collection</span> <span class="o">-&gt;</span> <span class="n">end</span><span class="p">();</span>
<span class="linenos" data-linenos="105 "></span><span class="kt">int</span> <span class="n">passed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="106 "></span>
<span class="linenos" data-linenos="107 "></span><span class="k">for</span> <span class="p">(</span><span class="n">Iterator</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">begin</span><span class="p">;</span> <span class="o">*</span><span class="n">p</span> <span class="o">!=</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="108 "></span>    <span class="k">if</span> <span class="p">(</span><span class="o">**</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">)</span>
<span class="linenos" data-linenos="109 "></span>        <span class="n">passed</span> <span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos="110 "></span><span class="p">}</span>
<span class="linenos" data-linenos="111 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">passed</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 5</span>
</code></pre></div>
<p>定义实现分开版本：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">//迭代器基类</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Iterator</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Iterator</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">virtual</span> <span class="n">Iterator</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">virtual</span> <span class="n">Iterator</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">virtual</span> <span class="kt">float</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">virtual</span> <span class="kt">float</span><span class="o">*</span> <span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">virtual</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Iterator</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Iterator</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="k">this</span> <span class="o">!=</span> <span class="n">other</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">};</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="k">class</span> <span class="nc">Collection</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Collection</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">virtual</span> <span class="n">Iterator</span><span class="o">*</span> <span class="n">begin</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>    <span class="k">virtual</span> <span class="n">Iterator</span><span class="o">*</span> <span class="n">end</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">size</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span><span class="p">};</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span><span class="c1">//继承自迭代器基类并配套ArrayCollection使用的迭代器</span>
<span class="linenos" data-linenos="24 "></span><span class="k">class</span> <span class="nc">ArrayIterator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Iterator</span> <span class="p">{</span>
<span class="linenos" data-linenos="25 "></span>    <span class="kt">float</span> <span class="o">*</span><span class="n">_data</span><span class="p">;</span>   <span class="c1">//ArrayCollection的数据</span>
<span class="linenos" data-linenos="26 "></span>    <span class="kt">int</span> <span class="n">_index</span><span class="p">;</span>     <span class="c1">//数据访问到的下标</span>
<span class="linenos" data-linenos="27 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="28 "></span>    <span class="n">ArrayIterator</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="o">:</span>
<span class="linenos" data-linenos="29 "></span>            <span class="n">_data</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="30 "></span>    <span class="n">ArrayIterator</span><span class="p">(</span><span class="k">const</span> <span class="n">ArrayIterator</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="o">:</span>
<span class="linenos" data-linenos="31 "></span>            <span class="n">_data</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">_data</span><span class="p">),</span> <span class="n">_index</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">_index</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="32 "></span>    <span class="o">~</span><span class="n">ArrayIterator</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="33 "></span>    <span class="n">Iterator</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">();</span>
<span class="linenos" data-linenos="34 "></span>    <span class="n">Iterator</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="linenos" data-linenos="35 "></span>    <span class="kt">float</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span><span class="p">();</span>
<span class="linenos" data-linenos="36 "></span>    <span class="kt">float</span><span class="o">*</span> <span class="k">operator</span><span class="o">-&gt;</span><span class="p">();</span>
<span class="linenos" data-linenos="37 "></span>    <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Iterator</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="linenos" data-linenos="38 "></span><span class="p">};</span>
<span class="linenos" data-linenos="39 "></span>
<span class="linenos" data-linenos="40 "></span><span class="k">class</span> <span class="nc">ArrayCollection</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Collection</span> <span class="p">{</span> <span class="c1">//底层为数组的存储结构类</span>
<span class="linenos" data-linenos="41 "></span>    <span class="k">friend</span> <span class="k">class</span> <span class="nc">ArrayIterator</span><span class="p">;</span> <span class="c1">//friend可以使得配套的迭代器类可以访问数据</span>
<span class="linenos" data-linenos="42 "></span>    <span class="kt">float</span><span class="o">*</span> <span class="n">_data</span><span class="p">;</span>
<span class="linenos" data-linenos="43 "></span>    <span class="kt">int</span> <span class="n">_size</span><span class="p">;</span>
<span class="linenos" data-linenos="44 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="45 "></span>    <span class="n">ArrayCollection</span><span class="p">()</span> <span class="o">:</span> <span class="n">_size</span><span class="p">(</span><span class="mi">10</span><span class="p">){</span><span class="n">_data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">_size</span><span class="p">];</span> <span class="p">}</span>
<span class="linenos" data-linenos="46 "></span>    <span class="n">ArrayCollection</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">data</span><span class="p">)</span> <span class="o">:</span> <span class="n">_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="47 "></span>        <span class="n">_data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">_size</span><span class="p">];</span>       <span class="c1">//开辟数组空间用以存储数据</span>
<span class="linenos" data-linenos="48 "></span>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos="49 "></span>            <span class="o">*</span><span class="p">(</span><span class="n">_data</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
<span class="linenos" data-linenos="50 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="51 "></span>    <span class="o">~</span><span class="n">ArrayCollection</span><span class="p">()</span> <span class="p">{</span> <span class="k">delete</span><span class="p">[]</span> <span class="n">_data</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="52 "></span>    <span class="kt">int</span> <span class="n">size</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_size</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="53 "></span>    <span class="n">Iterator</span><span class="o">*</span> <span class="n">begin</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="linenos" data-linenos="54 "></span>    <span class="n">Iterator</span><span class="o">*</span> <span class="nf">end</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="linenos" data-linenos="55 "></span><span class="p">};</span>
<span class="linenos" data-linenos="56 "></span><span class="n">Iterator</span><span class="o">*</span> <span class="n">ArrayCollection</span><span class="o">::</span><span class="n">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>  <span class="c1">//头迭代器，并放入相应数据</span>
<span class="linenos" data-linenos="57 "></span>    <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayIterator</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="linenos" data-linenos="58 "></span><span class="p">}</span>
<span class="linenos" data-linenos="59 "></span><span class="n">Iterator</span><span class="o">*</span> <span class="n">ArrayCollection</span><span class="o">::</span><span class="n">end</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>        <span class="c1">//尾迭代器，并放入相应数据</span>
<span class="linenos" data-linenos="60 "></span>    <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayIterator</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">_size</span><span class="p">);</span>
<span class="linenos" data-linenos="61 "></span><span class="p">}</span>
<span class="linenos" data-linenos="62 "></span>
<span class="linenos" data-linenos="63 "></span><span class="c1">//迭代器各种内容的实现</span>
<span class="linenos" data-linenos="64 "></span><span class="n">Iterator</span><span class="o">&amp;</span> <span class="n">ArrayIterator</span><span class="o">::</span><span class="k">operator</span><span class="o">++</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="65 "></span>    <span class="n">_index</span><span class="o">++</span><span class="p">;</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="linenos" data-linenos="66 "></span><span class="p">}</span>
<span class="linenos" data-linenos="67 "></span><span class="c1">//因为是数组，所以直接将空间指针位置+1即可，可以思考下这里为什么返回float&amp;，而不是Iterator</span>
<span class="linenos" data-linenos="68 "></span><span class="cm">/*</span>
<span class="linenos" data-linenos="69 "></span><span class="cm">float&amp; ArrayIterator::operator++(int) {</span>
<span class="linenos" data-linenos="70 "></span><span class="cm">    _index++;</span>
<span class="linenos" data-linenos="71 "></span><span class="cm">    return _data[_index - 1];</span>
<span class="linenos" data-linenos="72 "></span><span class="cm">}</span>
<span class="linenos" data-linenos="73 "></span><span class="cm">*/</span>
<span class="linenos" data-linenos="74 "></span><span class="n">Iterator</span><span class="o">&amp;</span> <span class="n">ArrayIterator</span><span class="o">::</span><span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="75 "></span>    <span class="n">ArrayIterator</span> <span class="nf">ret</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="linenos" data-linenos="76 "></span>    <span class="n">_index</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos="77 "></span>    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="linenos" data-linenos="78 "></span><span class="p">}</span>
<span class="linenos" data-linenos="79 "></span>
<span class="linenos" data-linenos="80 "></span><span class="c1">//对data的内存位置取值</span>
<span class="linenos" data-linenos="81 "></span><span class="kt">float</span><span class="o">&amp;</span> <span class="n">ArrayIterator</span><span class="o">::</span><span class="k">operator</span><span class="o">*</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="82 "></span>    <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">_data</span> <span class="o">+</span> <span class="n">_index</span><span class="p">);</span>
<span class="linenos" data-linenos="83 "></span><span class="p">}</span>
<span class="linenos" data-linenos="84 "></span><span class="kt">float</span><span class="o">*</span> <span class="n">ArrayIterator</span><span class="o">::</span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="85 "></span>    <span class="k">return</span> <span class="p">(</span><span class="n">_data</span> <span class="o">+</span> <span class="n">_index</span><span class="p">);</span>
<span class="linenos" data-linenos="86 "></span><span class="p">}</span>
<span class="linenos" data-linenos="87 "></span><span class="c1">//判断是不是指向内存的同一位置</span>
<span class="linenos" data-linenos="88 "></span><span class="kt">bool</span> <span class="n">ArrayIterator</span><span class="o">::</span><span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Iterator</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
<span class="linenos" data-linenos="89 "></span>    <span class="k">return</span> <span class="p">(</span><span class="n">_data</span> <span class="o">!=</span> <span class="p">((</span><span class="n">ArrayIterator</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">other</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">_data</span> <span class="o">||</span>
<span class="linenos" data-linenos="90 "></span>            <span class="n">_index</span> <span class="o">!=</span> <span class="p">((</span><span class="n">ArrayIterator</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">other</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">_index</span><span class="p">);</span>
<span class="linenos" data-linenos="91 "></span><span class="p">}</span>
</code></pre></div>
<p>hasNext实现模式：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="  1 "></span><span class="k">class</span> <span class="nc">Item</span>
<span class="linenos" data-linenos="  2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="  3 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="  4 "></span>    <span class="n">Item</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">strName</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span><span class="o">&amp;</span> <span class="n">price</span><span class="p">)</span><span class="o">:</span>
<span class="linenos" data-linenos="  5 "></span>            <span class="n">m_name</span><span class="p">(</span><span class="n">strName</span><span class="p">),</span><span class="n">m_price</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="p">{}</span>
<span class="linenos" data-linenos="  6 "></span>    <span class="n">Item</span><span class="p">(</span><span class="k">const</span> <span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span><span class="o">:</span>
<span class="linenos" data-linenos="  7 "></span>            <span class="n">m_name</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">m_name</span><span class="p">),</span><span class="n">m_price</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">m_price</span><span class="p">)</span> <span class="p">{}</span>
<span class="linenos" data-linenos="  8 "></span>    <span class="n">string</span> <span class="n">tostring</span><span class="p">()</span>
<span class="linenos" data-linenos="  9 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 10 "></span>        <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">buffer</span><span class="p">;</span>
<span class="linenos" data-linenos=" 11 "></span>        <span class="n">buffer</span> <span class="o">&lt;&lt;</span> <span class="n">m_price</span><span class="p">;</span>
<span class="linenos" data-linenos=" 12 "></span>        <span class="n">string</span> <span class="n">strPrice</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="linenos" data-linenos=" 13 "></span>        <span class="n">string</span> <span class="n">strName</span> <span class="o">=</span> <span class="n">m_name</span> <span class="o">+</span> <span class="s">&quot; :&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 14 "></span>        <span class="k">return</span> <span class="n">strName</span> <span class="o">+</span> <span class="n">strPrice</span><span class="p">;</span>
<span class="linenos" data-linenos=" 15 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 16 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 17 "></span>    <span class="n">string</span> <span class="n">m_name</span><span class="p">;</span>
<span class="linenos" data-linenos=" 18 "></span>    <span class="kt">float</span> <span class="n">m_price</span><span class="p">;</span>
<span class="linenos" data-linenos=" 19 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 20 "></span>
<span class="linenos" data-linenos=" 21 "></span><span class="k">class</span> <span class="nc">Container</span><span class="p">;</span>
<span class="linenos" data-linenos=" 22 "></span><span class="k">class</span> <span class="nc">Menu</span><span class="p">;</span>
<span class="linenos" data-linenos=" 23 "></span><span class="k">class</span> <span class="nc">MenuIterator</span><span class="p">;</span>
<span class="linenos" data-linenos=" 24 "></span>
<span class="linenos" data-linenos=" 25 "></span>
<span class="linenos" data-linenos=" 26 "></span><span class="k">class</span> <span class="nc">Iterator</span>
<span class="linenos" data-linenos=" 27 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 28 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 29 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Iterator</span><span class="p">()</span> <span class="p">{}</span>
<span class="linenos" data-linenos=" 30 "></span>    <span class="c1">//virtual void first() = 0;</span>
<span class="linenos" data-linenos=" 31 "></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">next</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 32 "></span>    <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">hasnext</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 33 "></span>    <span class="k">virtual</span> <span class="n">Item</span><span class="o">*</span> <span class="n">current</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 34 "></span><span class="k">protected</span><span class="o">:</span>
<span class="linenos" data-linenos=" 35 "></span>    <span class="n">Container</span> <span class="o">*</span> <span class="n">m_pContainer</span><span class="p">;</span>
<span class="linenos" data-linenos=" 36 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 37 "></span>
<span class="linenos" data-linenos=" 38 "></span>
<span class="linenos" data-linenos=" 39 "></span><span class="k">class</span> <span class="nc">Container</span>
<span class="linenos" data-linenos=" 40 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 41 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 42 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Container</span><span class="p">()</span> <span class="p">{};</span>
<span class="linenos" data-linenos=" 43 "></span><span class="k">protected</span><span class="o">:</span>
<span class="linenos" data-linenos=" 44 "></span>    <span class="c1">//Observer(){};</span>
<span class="linenos" data-linenos=" 45 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 46 "></span>
<span class="linenos" data-linenos=" 47 "></span>
<span class="linenos" data-linenos=" 48 "></span><span class="k">class</span> <span class="nc">Menu</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Container</span>
<span class="linenos" data-linenos=" 49 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 50 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 51 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Menu</span><span class="p">()</span>
<span class="linenos" data-linenos=" 52 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 53 "></span>        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">m_items</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos=" 54 "></span>        <span class="p">{</span>
<span class="linenos" data-linenos=" 55 "></span>            <span class="k">delete</span> <span class="n">m_items</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos" data-linenos=" 56 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 57 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 58 "></span>    <span class="kt">int</span> <span class="n">size</span><span class="p">()</span>
<span class="linenos" data-linenos=" 59 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 60 "></span>        <span class="k">return</span> <span class="n">m_items</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="linenos" data-linenos=" 61 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 62 "></span>    <span class="n">Item</span><span class="o">*</span> <span class="n">value</span><span class="p">(</span><span class="kt">int</span> <span class="n">nIndex</span><span class="p">)</span>
<span class="linenos" data-linenos=" 63 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 64 "></span>        <span class="k">if</span><span class="p">(</span><span class="n">nIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">nIndex</span> <span class="o">&lt;</span> <span class="n">m_items</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
<span class="linenos" data-linenos=" 65 "></span>        <span class="p">{</span>
<span class="linenos" data-linenos=" 66 "></span>            <span class="k">return</span> <span class="n">m_items</span><span class="p">[</span><span class="n">nIndex</span><span class="p">];</span>
<span class="linenos" data-linenos=" 67 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 68 "></span>        <span class="k">else</span>
<span class="linenos" data-linenos=" 69 "></span>        <span class="p">{</span>
<span class="linenos" data-linenos=" 70 "></span>            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="linenos" data-linenos=" 71 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos=" 72 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 73 "></span>    <span class="kt">void</span> <span class="n">additem</span><span class="p">(</span><span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span>
<span class="linenos" data-linenos=" 74 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 75 "></span>        <span class="n">Item</span> <span class="o">*</span><span class="n">pItem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="linenos" data-linenos=" 76 "></span>        <span class="n">m_items</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pItem</span><span class="p">);</span>
<span class="linenos" data-linenos=" 77 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 78 "></span>
<span class="linenos" data-linenos=" 79 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 80 "></span>    <span class="k">friend</span> <span class="k">class</span> <span class="nc">MenuIterator</span><span class="p">;</span>
<span class="linenos" data-linenos=" 81 "></span>    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">*&gt;</span> <span class="n">m_items</span><span class="p">;</span>
<span class="linenos" data-linenos=" 82 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 83 "></span>
<span class="linenos" data-linenos=" 84 "></span>
<span class="linenos" data-linenos=" 85 "></span><span class="k">class</span> <span class="nc">MenuIterator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Iterator</span>
<span class="linenos" data-linenos=" 86 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 87 "></span>    <span class="n">Menu</span><span class="o">*</span> <span class="n">m_menu</span><span class="p">;</span>
<span class="linenos" data-linenos=" 88 "></span>    <span class="kt">int</span> <span class="n">curpos</span><span class="p">;</span>
<span class="linenos" data-linenos=" 89 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 90 "></span>    <span class="n">MenuIterator</span><span class="p">(</span><span class="n">Menu</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">)</span><span class="o">:</span> <span class="n">m_menu</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">),</span> <span class="n">curpos</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
<span class="linenos" data-linenos=" 91 "></span>    <span class="cm">/*virtual void first()</span>
<span class="linenos" data-linenos=" 92 "></span><span class="cm">    {</span>
<span class="linenos" data-linenos=" 93 "></span><span class="cm">        curpos=0;</span>
<span class="linenos" data-linenos=" 94 "></span><span class="cm">    }*/</span>
<span class="linenos" data-linenos=" 95 "></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">next</span><span class="p">()</span>
<span class="linenos" data-linenos=" 96 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 97 "></span>        <span class="n">curpos</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-linenos=" 98 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 99 "></span>    <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">hasnext</span><span class="p">()</span>
<span class="linenos" data-linenos="100 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="101 "></span>        <span class="k">if</span><span class="p">(</span><span class="n">curpos</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">curpos</span> <span class="o">&lt;</span> <span class="n">m_menu</span><span class="o">-&gt;</span><span class="n">m_items</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
<span class="linenos" data-linenos="102 "></span>            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="linenos" data-linenos="103 "></span>        <span class="k">else</span>
<span class="linenos" data-linenos="104 "></span>            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="linenos" data-linenos="105 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="106 "></span>    <span class="k">virtual</span> <span class="n">Item</span><span class="o">*</span> <span class="n">current</span><span class="p">()</span>
<span class="linenos" data-linenos="107 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="108 "></span>        <span class="k">return</span> <span class="n">m_menu</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">(</span><span class="n">curpos</span><span class="p">);</span>
<span class="linenos" data-linenos="109 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="110 "></span><span class="p">};</span>
<span class="linenos" data-linenos="111 "></span>
<span class="linenos" data-linenos="112 "></span>
<span class="linenos" data-linenos="113 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="linenos" data-linenos="114 "></span><span class="p">{</span>
<span class="linenos" data-linenos="115 "></span>    <span class="n">Item</span> <span class="n">it1</span><span class="p">(</span><span class="s">&quot;chicken&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">);</span>
<span class="linenos" data-linenos="116 "></span>    <span class="n">Item</span> <span class="n">it2</span><span class="p">(</span><span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">);</span>
<span class="linenos" data-linenos="117 "></span>    <span class="n">Item</span> <span class="n">it3</span><span class="p">(</span><span class="s">&quot;Beaf&quot;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">);</span>
<span class="linenos" data-linenos="118 "></span>    <span class="n">Item</span> <span class="n">it4</span><span class="p">(</span><span class="s">&quot;soup&quot;</span><span class="p">,</span><span class="mf">15.0</span><span class="p">);</span>
<span class="linenos" data-linenos="119 "></span>
<span class="linenos" data-linenos="120 "></span>    <span class="n">Menu</span> <span class="n">menu</span><span class="p">;</span>
<span class="linenos" data-linenos="121 "></span>    <span class="n">menu</span><span class="p">.</span><span class="n">additem</span><span class="p">(</span><span class="n">it1</span><span class="p">);</span>
<span class="linenos" data-linenos="122 "></span>    <span class="n">menu</span><span class="p">.</span><span class="n">additem</span><span class="p">(</span><span class="n">it2</span><span class="p">);</span>
<span class="linenos" data-linenos="123 "></span>    <span class="n">menu</span><span class="p">.</span><span class="n">additem</span><span class="p">(</span><span class="n">it3</span><span class="p">);</span>
<span class="linenos" data-linenos="124 "></span>    <span class="n">menu</span><span class="p">.</span><span class="n">additem</span><span class="p">(</span><span class="n">it4</span><span class="p">);</span>
<span class="linenos" data-linenos="125 "></span>
<span class="linenos" data-linenos="126 "></span>    <span class="n">Iterator</span><span class="o">*</span> <span class="n">iter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MenuIterator</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
<span class="linenos" data-linenos="127 "></span>
<span class="linenos" data-linenos="128 "></span>    <span class="k">while</span><span class="p">(</span><span class="n">iter</span><span class="o">-&gt;</span><span class="n">hasnext</span><span class="p">())</span>
<span class="linenos" data-linenos="129 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="130 "></span>        <span class="n">Item</span><span class="o">*</span> <span class="n">pItem</span> <span class="o">=</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">();</span>
<span class="linenos" data-linenos="131 "></span>        <span class="k">if</span><span class="p">(</span><span class="n">pItem</span><span class="p">)</span>
<span class="linenos" data-linenos="132 "></span>            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">tostring</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="133 "></span>        <span class="n">iter</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
<span class="linenos" data-linenos="134 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="135 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="2342">2.34.2 模板方法</h4>
<p>抽象父类定义接口、流程，（每种组合的）子类具体实现。针对接口编程。</p>
<p>抽象类：一次完成两个操作。操作1有m种实现，操作2有n种实现。</p>
<p>则一共需要m*n个子类实现全部完成操作的方式。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">AbstractClass</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">operation1</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">operation2</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="p">{</span> <span class="c1">// 定义一个算法流程</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="n">operation1</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span>        <span class="n">operation2</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">};</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="k">class</span> <span class="nc">ConcreteA</span> <span class="o">:</span> <span class="k">public</span> <span class="n">AbstractClass</span>
<span class="linenos" data-linenos="15 "></span><span class="p">{</span>   <span class="c1">// 实现方案组合A</span>
<span class="linenos" data-linenos="16 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="17 "></span>    <span class="kt">void</span> <span class="n">operation1</span><span class="p">()</span>
<span class="linenos" data-linenos="18 "></span>  <span class="p">{</span> <span class="c1">// 定义不同的操作</span>
<span class="linenos" data-linenos="19 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ConcreteA::operation1&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> 
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>    <span class="kt">void</span> <span class="n">operation2</span><span class="p">()</span>
<span class="linenos" data-linenos="22 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="23 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ConcreteA::operation2&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="24 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="p">};</span>
<span class="linenos" data-linenos="26 "></span>
<span class="linenos" data-linenos="27 "></span><span class="k">class</span> <span class="nc">ConcreteB</span> <span class="o">:</span> <span class="k">public</span> <span class="n">AbstractClass</span>
<span class="linenos" data-linenos="28 "></span><span class="p">{</span>   <span class="c1">// 实现方案组合B</span>
<span class="linenos" data-linenos="29 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="30 "></span>    <span class="kt">void</span> <span class="n">operation1</span><span class="p">()</span>
<span class="linenos" data-linenos="31 "></span>  <span class="p">{</span> <span class="c1">// 定义不同的操作</span>
<span class="linenos" data-linenos="32 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ConcreteB::operation1&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> 
<span class="linenos" data-linenos="33 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="34 "></span>    <span class="kt">void</span> <span class="n">operation2</span><span class="p">()</span>
<span class="linenos" data-linenos="35 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="36 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ConcreteB::operation2&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="37 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="38 "></span><span class="p">};</span>
<span class="linenos" data-linenos="39 "></span>
<span class="linenos" data-linenos="40 "></span><span class="n">AbstractClass</span><span class="o">*</span> <span class="n">absClass</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="k">new</span> <span class="nf">ConcreteA</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ConcreteB</span><span class="p">()</span> <span class="p">};</span>
<span class="linenos" data-linenos="41 "></span><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">x</span><span class="p">:</span> <span class="n">absClass</span><span class="p">)</span>
<span class="linenos" data-linenos="42 "></span><span class="p">{</span>
<span class="linenos" data-linenos="43 "></span>        <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">run</span><span class="p">();</span>
<span class="linenos" data-linenos="44 "></span>        <span class="k">delete</span> <span class="n">x</span><span class="p">;</span>
<span class="linenos" data-linenos="45 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="2343">2.34.3 策略模式</h4>
<p>抽象类定义操作流程，初始化时接收各步操作的具体的策略子类。</p>
<p>父类：一次完成两个操作。操作1有m种实现策略，操作2有n种实现策略。</p>
<p>则一共需要m+n个策略子类实现全部完成操作的方式。</p>
<p>单一责任原则。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">AbstractClass</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>  <span class="c1">// 获取不同的策略类的每一步操作的策略指针</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="n">Op1Strategy</span> <span class="o">*</span><span class="n">op1_strategy</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="n">Op2Strategy</span> <span class="o">*</span><span class="n">op2_strategy</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="c1">// 各个策略类的组合</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="n">AbstractClass</span><span class="p">(</span><span class="n">Op1Strategy</span><span class="o">*</span> <span class="n">op1</span><span class="p">,</span> <span class="n">Op2Strategy</span><span class="o">*</span> <span class="n">op2</span><span class="p">)</span> <span class="o">:</span> 
<span class="linenos" data-linenos=" 9 "></span>        <span class="n">op1_strategy</span><span class="p">(</span><span class="n">op1</span><span class="p">),</span> <span class="n">op2_strategy</span><span class="p">(</span><span class="n">op2</span><span class="p">)</span> <span class="p">{}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="c1">// 定义操作流程</span>
<span class="linenos" data-linenos="12 "></span>    <span class="kt">void</span> <span class="n">run</span><span class="p">()</span>
<span class="linenos" data-linenos="13 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="n">op1_strategy</span><span class="o">-&gt;</span><span class="n">operate</span><span class="p">();</span>    <span class="c1">// 执行策略</span>
<span class="linenos" data-linenos="15 "></span>        <span class="n">op2_strategy</span><span class="o">-&gt;</span><span class="n">operate</span><span class="p">();</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span><span class="p">};</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="c1">// 操作1策略基类</span>
<span class="linenos" data-linenos="20 "></span><span class="k">class</span> <span class="nc">Op1Strategy</span>
<span class="linenos" data-linenos="21 "></span><span class="p">{</span>
<span class="linenos" data-linenos="22 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="23 "></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">operate</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="24 "></span><span class="p">}</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span><span class="c1">// 操作1具体实现1</span>
<span class="linenos" data-linenos="27 "></span><span class="k">class</span> <span class="nc">Op1StrategyImpl1</span><span class="o">:</span> <span class="k">public</span> <span class="n">Op1Strategy</span>
<span class="linenos" data-linenos="28 "></span><span class="p">{</span>
<span class="linenos" data-linenos="29 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="30 "></span>    <span class="kt">void</span> <span class="n">operate</span><span class="p">()</span>
<span class="linenos" data-linenos="31 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="32 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Operation1 Implementation 1&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="33 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="34 "></span><span class="p">}</span>
<span class="linenos" data-linenos="35 "></span>
<span class="linenos" data-linenos="36 "></span><span class="c1">// 操作1具体实现2</span>
<span class="linenos" data-linenos="37 "></span><span class="k">class</span> <span class="nc">Op1StrategyImpl2</span><span class="o">:</span> <span class="k">public</span> <span class="n">Op1Strategy</span>
<span class="linenos" data-linenos="38 "></span><span class="p">{</span>
<span class="linenos" data-linenos="39 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="40 "></span>    <span class="kt">void</span> <span class="n">operate</span><span class="p">()</span>
<span class="linenos" data-linenos="41 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="42 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Operation1 Implementation 2&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="43 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="44 "></span><span class="p">}</span>
<span class="linenos" data-linenos="45 "></span>
<span class="linenos" data-linenos="46 "></span><span class="c1">// in main:</span>
<span class="linenos" data-linenos="47 "></span><span class="n">Op1StrategyImpl1</span><span class="o">*</span> <span class="n">op1imp1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Op1StrategyImpl1</span><span class="p">();</span>
<span class="linenos" data-linenos="48 "></span><span class="n">Op2StrategyImpl1</span><span class="o">*</span> <span class="n">op2imp1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Op2StrategyImpl1</span><span class="p">();</span>
<span class="linenos" data-linenos="49 "></span><span class="n">AbstractClass</span><span class="o">*</span> <span class="n">solve</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AbstractClass</span><span class="p">(</span><span class="n">op1imp1</span><span class="p">,</span> <span class="n">op2imp2</span><span class="p">);</span>
<span class="linenos" data-linenos="50 "></span><span class="n">solve</span><span class="o">-&gt;</span><span class="n">run</span><span class="p">();</span>
</code></pre></div>
<h3 id="235">2.35 结构型模式</h3>
<p>能在结构层面上尽可能的解耦合</p>
<h4 id="2351">2.35.1 适配器模式</h4>
<p>将一个类的接口转换成客户希望的另一个接口，从而使得原本由于接口不兼容而不能一起工作的类可以在统一的接口环境下工作。</p>
<h5 id="23511">2.35.1.1 组合适配</h5>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">//堆栈基类</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">class</span> <span class="nc">Stack</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">virtual</span> <span class="o">~</span><span class="n">Stack</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">virtual</span>     <span class="kt">bool</span> <span class="n">full</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">virtual</span>     <span class="kt">bool</span> <span class="n">empty</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">virtual</span>     <span class="kt">void</span> <span class="n">push</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">virtual</span>     <span class="kt">void</span> <span class="n">pop</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">virtual</span>     <span class="kt">int</span> <span class="n">size</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">virtual</span>     <span class="kt">int</span> <span class="n">top</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="k">class</span> <span class="nc">Vector2Stack</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Stack</span>
<span class="linenos" data-linenos="15 "></span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos="17 "></span>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">m_data</span><span class="p">;</span> <span class="c1">//将vector的接口组合进来实现具体功能</span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">const</span> <span class="kt">int</span> <span class="n">m_size</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="20 "></span>    <span class="n">Vector2Stack</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>    <span class="kt">bool</span> <span class="n">full</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">m_size</span><span class="p">;</span> <span class="p">}</span>    <span class="c1">//满栈检测</span>
<span class="linenos" data-linenos="22 "></span>    <span class="kt">bool</span> <span class="n">empty</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>    <span class="c1">//空栈检测</span>
<span class="linenos" data-linenos="23 "></span>    <span class="kt">void</span> <span class="n">push</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">m_data</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="p">}</span>       <span class="c1">//入栈</span>
<span class="linenos" data-linenos="24 "></span>    <span class="kt">void</span> <span class="n">pop</span><span class="p">()</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">())</span> <span class="n">m_data</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span> <span class="p">}</span> <span class="c1">//出栈</span>
<span class="linenos" data-linenos="25 "></span>    <span class="kt">int</span> <span class="n">size</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="p">}</span>                <span class="c1">//获取堆栈已用空间</span>
<span class="linenos" data-linenos="26 "></span>    <span class="kt">int</span> <span class="n">top</span><span class="p">()</span> <span class="p">{</span>                                     <span class="c1">//获取栈头内容</span>
<span class="linenos" data-linenos="27 "></span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">())</span> 
<span class="linenos" data-linenos="28 "></span>            <span class="k">return</span> <span class="n">m_data</span><span class="p">[</span><span class="n">m_data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="mi">-1</span><span class="p">];</span>
<span class="linenos" data-linenos="29 "></span>        <span class="k">else</span> 
<span class="linenos" data-linenos="30 "></span>            <span class="k">return</span> <span class="n">INT_MIN</span><span class="p">;</span>
<span class="linenos" data-linenos="31 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="32 "></span><span class="p">};</span>
<span class="linenos" data-linenos="33 "></span>
<span class="linenos" data-linenos="34 "></span><span class="n">Vector2Stack</span> <span class="nf">stack</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>
<h5 id="23512">2.35.1.2 继承适配</h5>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">//直接继承vector并改造接口，采用私有继承可以使得外界只能接触到Vector2Stack中的接口</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">class</span> <span class="nc">Vector2Stack</span> <span class="o">:</span> <span class="k">private</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">public</span> <span class="n">Stack</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="n">Vector2Stack</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="kt">bool</span> <span class="n">full</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="kt">bool</span> <span class="n">empty</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">empty</span><span class="p">();</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="kt">void</span> <span class="n">push</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="kt">void</span> <span class="n">pop</span><span class="p">()</span> <span class="p">{</span> <span class="n">pop_back</span><span class="p">();</span> <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>    <span class="kt">int</span> <span class="n">size</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">size</span><span class="p">();</span> <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>    <span class="kt">int</span> <span class="n">top</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">back</span><span class="p">();</span> <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">};</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="n">Vector2Stack</span> <span class="nf">stack</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>
<h4 id="2352">2.35.2 代理/委托模式</h4>
<p>在被访问对象上加上一个访问层，将复杂操作包裹在内部不对外部类开放，仅对外开放功能接口，即可完成上述要求，这就是代理/委托模式。</p>
<p>适配器的核心要素是变换接口，代理的核心要素是分割访问对象与被访问对象以减少耦合，并能<strong>在中间增加各种控制功能</strong>。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> 
<span class="linenos" data-linenos=" 2 "></span><span class="c1">//提前声明智能指针模板类</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">class</span> <span class="nc">SmartPtr</span><span class="p">;</span> 
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">//辅助指针，用于存储指针计数以及封装实际指针地址</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">U_Ptr</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">friend</span> <span class="k">class</span> <span class="nc">SmartPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="n">U_Ptr</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="o">:</span><span class="n">p</span><span class="p">(</span><span class="n">ptr</span><span class="p">),</span> <span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="o">~</span><span class="n">U_Ptr</span><span class="p">()</span> <span class="p">{</span> <span class="k">delete</span> <span class="n">p</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>   
<span class="linenos" data-linenos="15 "></span>    <span class="n">T</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="c1">//数据存放地址</span>
<span class="linenos" data-linenos="16 "></span><span class="p">};</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="c1">//智能指针</span>
<span class="linenos" data-linenos="20 "></span><span class="k">class</span> <span class="nc">SmartPtr</span> <span class="p">{</span>
<span class="linenos" data-linenos="21 "></span><span class="k">private</span><span class="o">:</span>
<span class="linenos" data-linenos="22 "></span>    <span class="n">U_Ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">rp</span><span class="p">;</span>   <span class="c1">//进行实际指针操作的辅助指针</span>
<span class="linenos" data-linenos="23 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="24 "></span>    <span class="n">SmartPtr</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="o">:</span><span class="n">rp</span><span class="p">(</span><span class="k">new</span> <span class="n">U_Ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="25 "></span>    <span class="c1">//调动拷贝构造即增加引用计数</span>
<span class="linenos" data-linenos="26 "></span>    <span class="n">SmartPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">SmartPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sp</span><span class="p">)</span> <span class="o">:</span><span class="n">rp</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">rp</span><span class="p">)</span> <span class="p">{</span> <span class="o">++</span><span class="n">rp</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span>    <span class="n">SmartPtr</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">SmartPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="28 "></span>        <span class="o">++</span><span class="n">rhs</span><span class="p">.</span><span class="n">rp</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span> <span class="c1">//赋值号后的指针引用加1</span>
<span class="linenos" data-linenos="29 "></span>        <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">rp</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">delete</span> <span class="n">rp</span><span class="p">;</span>    <span class="c1">//原内部指针引用减1</span>
<span class="linenos" data-linenos="30 "></span>        <span class="n">rp</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">rp</span><span class="p">;</span>        <span class="c1">//代理新的指针</span>
<span class="linenos" data-linenos="31 "></span>        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="linenos" data-linenos="32 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="33 "></span>    <span class="o">~</span><span class="n">SmartPtr</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//只有引用次数为0才会释放</span>
<span class="linenos" data-linenos="34 "></span>        <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">rp</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">delete</span> <span class="n">rp</span><span class="p">;</span>
<span class="linenos" data-linenos="35 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="36 "></span>    <span class="c1">//对智能指针操作等同于对内部辅助指针操作</span>
<span class="linenos" data-linenos="37 "></span>    <span class="n">T</span> <span class="o">&amp;</span> <span class="k">operator</span> <span class="o">*</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">rp</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">);</span> <span class="p">}</span>
<span class="linenos" data-linenos="38 "></span>    <span class="n">T</span><span class="o">*</span> <span class="k">operator</span> <span class="o">-&gt;</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">rp</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="39 "></span><span class="p">};</span>
<span class="linenos" data-linenos="40 "></span>
<span class="linenos" data-linenos="41 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="linenos" data-linenos="42 "></span><span class="p">{</span>
<span class="linenos" data-linenos="43 "></span>    <span class="c1">//声明指针</span>
<span class="linenos" data-linenos="44 "></span>    <span class="kt">int</span> <span class="o">*</span><span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="linenos" data-linenos="45 "></span>    <span class="c1">//使用代理来包裹指针</span>
<span class="linenos" data-linenos="46 "></span>    <span class="n">SmartPtr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ptr1</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="linenos" data-linenos="47 "></span>    <span class="n">SmartPtr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ptr2</span><span class="p">(</span><span class="n">ptr1</span><span class="p">);</span>
<span class="linenos" data-linenos="48 "></span>    <span class="n">SmartPtr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ptr3</span> <span class="o">=</span> <span class="n">ptr2</span><span class="p">;</span>
<span class="linenos" data-linenos="49 "></span>    <span class="c1">//之后的操作均通过代理进行</span>
<span class="linenos" data-linenos="50 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">ptr1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="51 "></span>    <span class="o">*</span><span class="n">ptr1</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="linenos" data-linenos="52 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">ptr2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="53 "></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="54 "></span><span class="p">}</span>
</code></pre></div>
<h4 id="2353">2.35.3 装饰器模式</h4>
<p>统一继承自Component。</p>
<p>最后是链式调用。</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">//所有View的基类</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">class</span> <span class="nc">Component</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Component</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">draw</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">};</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="c1">//一个基本的TextView类</span>
<span class="linenos" data-linenos="12 "></span><span class="k">class</span> <span class="nc">TextView</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Component</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="14 "></span>    <span class="kt">void</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;TextView.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span><span class="p">};</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="c1">//装饰器的核心内涵在于用装饰器类整体包裹改动之前的类，以保留原来的全部接口</span>
<span class="linenos" data-linenos="20 "></span><span class="c1">//在原来接口保留的基础上进行新功能扩充</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span><span class="k">class</span> <span class="nc">Decorator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Component</span> <span class="p">{</span>
<span class="linenos" data-linenos="23 "></span>    <span class="c1">//这里一个基类指针可以让Decorator能够以递归的形式不断增加新功能</span>
<span class="linenos" data-linenos="24 "></span>    <span class="n">Component</span><span class="o">*</span> <span class="n">_component</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="26 "></span>    <span class="n">Decorator</span><span class="p">(</span><span class="n">Component</span><span class="o">*</span> <span class="n">component</span><span class="p">)</span> <span class="o">:</span> <span class="n">_component</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="27 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="28 "></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">addon</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="29 "></span>    <span class="kt">void</span> <span class="nf">draw</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="30 "></span>        <span class="n">addon</span><span class="p">();</span>
<span class="linenos" data-linenos="31 "></span>        <span class="n">_component</span> <span class="o">-&gt;</span> <span class="n">draw</span><span class="p">();</span>
<span class="linenos" data-linenos="32 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="33 "></span><span class="p">};</span>
<span class="linenos" data-linenos="34 "></span>
<span class="linenos" data-linenos="35 "></span><span class="c1">//包裹原Component并扩充边框</span>
<span class="linenos" data-linenos="36 "></span><span class="k">class</span> <span class="nc">Border</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Decorator</span> <span class="p">{</span>
<span class="linenos" data-linenos="37 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="38 "></span>    <span class="n">Border</span><span class="p">(</span><span class="n">Component</span><span class="o">*</span> <span class="n">component</span><span class="p">)</span> <span class="o">:</span> <span class="n">Decorator</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="39 "></span>    <span class="kt">void</span> <span class="n">addon</span><span class="p">()</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Bordered &quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="40 "></span><span class="p">};</span>
<span class="linenos" data-linenos="41 "></span>
<span class="linenos" data-linenos="42 "></span><span class="c1">//包裹原Component并扩充水平滚动条</span>
<span class="linenos" data-linenos="43 "></span><span class="k">class</span> <span class="nc">HScroll</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Decorator</span> <span class="p">{</span>
<span class="linenos" data-linenos="44 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="45 "></span>    <span class="n">HScroll</span><span class="p">(</span><span class="n">Component</span><span class="o">*</span> <span class="n">component</span><span class="p">)</span><span class="o">:</span> <span class="n">Decorator</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="46 "></span>    <span class="kt">void</span> <span class="n">addon</span><span class="p">()</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;HScrolled &quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="47 "></span><span class="p">};</span>
<span class="linenos" data-linenos="48 "></span>
<span class="linenos" data-linenos="49 "></span><span class="c1">//包裹原Component并扩充垂直滚动条</span>
<span class="linenos" data-linenos="50 "></span><span class="k">class</span> <span class="nc">VScroll</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Decorator</span> <span class="p">{</span>
<span class="linenos" data-linenos="51 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="52 "></span>    <span class="n">VScroll</span><span class="p">(</span><span class="n">Component</span><span class="o">*</span> <span class="n">component</span><span class="p">)</span><span class="o">:</span> <span class="n">Decorator</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="linenos" data-linenos="53 "></span>    <span class="kt">void</span> <span class="n">addon</span><span class="p">()</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;VScrolled &quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="54 "></span><span class="p">};</span>
<span class="linenos" data-linenos="55 "></span>
<span class="linenos" data-linenos="56 "></span>
<span class="linenos" data-linenos="57 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="linenos" data-linenos="58 "></span><span class="p">{</span>
<span class="linenos" data-linenos="59 "></span>    <span class="c1">//基础的textView</span>
<span class="linenos" data-linenos="60 "></span>    <span class="n">TextView</span> <span class="n">textView</span><span class="p">;</span>
<span class="linenos" data-linenos="61 "></span>    <span class="c1">//在基础textView上增加滚动条</span>
<span class="linenos" data-linenos="62 "></span>    <span class="n">VScroll</span> <span class="n">vs_TextView</span><span class="p">(</span><span class="o">&amp;</span><span class="n">textView</span><span class="p">);</span>
<span class="linenos" data-linenos="63 "></span>    <span class="c1">//在增加垂直滚动条的基础上增加滚动横条</span>
<span class="linenos" data-linenos="64 "></span>    <span class="n">HScroll</span> <span class="n">hs_vs_TextView</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vs_TextView</span><span class="p">);</span>
<span class="linenos" data-linenos="65 "></span>    <span class="c1">//在增加水平与垂直滚动条之后增加边框</span>
<span class="linenos" data-linenos="66 "></span>    <span class="n">Border</span> <span class="n">b_hs_vs_TextView</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hs_vs_TextView</span><span class="p">);</span>
<span class="linenos" data-linenos="67 "></span>    <span class="n">b_hs_vs_TextView</span><span class="p">.</span><span class="n">draw</span><span class="p">();</span>
<span class="linenos" data-linenos="68 "></span>
<span class="linenos" data-linenos="69 "></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="70 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="236">2.36 创建型模式</h3>
<h4 id="2361">2.36.1 单例模式</h4>
<h4 id="2362">2.36.2 工厂模式</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">TeaFactory</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="kt">void</span> <span class="n">setMilk</span><span class="p">(</span><span class="kt">int</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="kt">void</span> <span class="n">setSugar</span><span class="p">(</span><span class="kt">int</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="n">Tea</span> <span class="o">*</span><span class="n">createTea</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="n">Tea</span> <span class="o">*</span><span class="n">tea</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="s">&quot;GreenTea&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 8 "></span>            <span class="n">tea</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GreenTea</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="s">&quot;BlackTea&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="10 "></span>            <span class="n">tea</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Blacktea</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">else</span> <span class="p">...</span>  <span class="c1">// 其他可能的茶叶类型</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">if</span> <span class="p">(</span><span class="n">milkAmount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">tea</span><span class="o">-&gt;</span><span class="n">addMilk</span><span class="p">(...);</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">if</span> <span class="p">(</span><span class="n">sugarAmount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">tea</span><span class="o">-&gt;</span><span class="n">addSugar</span><span class="p">(...);</span>
<span class="linenos" data-linenos="14 "></span>        <span class="p">...</span>  <span class="c1">// 其他的属性配置</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span><span class="p">};</span>
</code></pre></div>
<h4 id="2363">2.36.3 抽象工厂模式</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">AbstractLanguageFactory</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">virtual</span> <span class="n">Lexer</span> <span class="o">*</span><span class="n">createLexer</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">virtual</span> <span class="n">Parser</span> <span class="o">*</span><span class="n">createParser</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">virtual</span> <span class="n">Generator</span> <span class="o">*</span><span class="n">createGenerator</span><span class="p">();</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">};</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">class</span> <span class="nc">CppFactory</span> <span class="o">:</span> <span class="k">public</span> <span class="n">AbstractLanguageFactory</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="10 "></span>    <span class="n">Lexer</span> <span class="o">*</span><span class="n">createLexer</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">CppLexer</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>    <span class="n">Parser</span> <span class="o">*</span><span class="n">createParser</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">CppParser</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>    <span class="n">Generator</span> <span class="o">*</span><span class="n">createGenerator</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">CppGenerator</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">};</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="k">class</span> <span class="nc">JavaFactory</span> <span class="o">:</span> <span class="k">public</span> <span class="n">AbstractLanguageFactory</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="k">class</span> <span class="nc">Compiler</span> <span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>    <span class="n">AbstractFactory</span> <span class="o">*</span><span class="n">factory</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span><span class="k">public</span><span class="o">:</span>
<span class="linenos" data-linenos="20 "></span>    <span class="n">Compiler</span><span class="p">(</span><span class="n">AbstractFactory</span> <span class="o">*</span><span class="n">factory</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="21 "></span>        <span class="k">this</span><span class="o">-&gt;</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="23 "></span>    <span class="n">LexResult</span> <span class="o">*</span><span class="n">lex</span><span class="p">(</span><span class="n">Code</span> <span class="o">*</span><span class="n">input</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>        <span class="n">Lexer</span> <span class="o">*</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">factory</span><span class="o">-&gt;</span><span class="n">createLexer</span><span class="p">();</span>
<span class="linenos" data-linenos="25 "></span>        <span class="k">return</span> <span class="n">lexer</span><span class="o">-&gt;</span><span class="n">lex</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span>    <span class="n">ParseResult</span> <span class="o">*</span><span class="n">parse</span><span class="p">(</span><span class="n">LexResult</span> <span class="o">*</span><span class="n">input</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="28 "></span>        <span class="n">Parser</span> <span class="o">*</span><span class="n">parser</span> <span class="o">=</span> <span class="n">factory</span><span class="o">-&gt;</span><span class="n">createParser</span><span class="p">();</span>
<span class="linenos" data-linenos="29 "></span>        <span class="k">return</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">parse</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<span class="linenos" data-linenos="30 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="31 "></span>    <span class="c1">// ...</span>
<span class="linenos" data-linenos="32 "></span><span class="p">};</span>
<span class="linenos" data-linenos="33 "></span>
<span class="linenos" data-linenos="34 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="35 "></span>    <span class="n">CppFactory</span> <span class="o">*</span><span class="n">cppFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CppFactory</span><span class="p">();</span>
<span class="linenos" data-linenos="36 "></span>    <span class="n">Compiler</span> <span class="o">*</span><span class="n">cppCompiler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Compiler</span><span class="p">(</span><span class="n">cppFactory</span><span class="p">);</span>
<span class="linenos" data-linenos="37 "></span>
<span class="linenos" data-linenos="38 "></span>    <span class="n">Code</span> <span class="o">*</span><span class="n">code</span> <span class="o">=</span> <span class="p">...</span>
<span class="linenos" data-linenos="39 "></span>    <span class="n">LexResult</span> <span class="o">*</span><span class="n">lex</span> <span class="o">=</span> <span class="n">cppCompiler</span><span class="o">-&gt;</span><span class="n">lex</span><span class="p">(</span><span class="n">code</span><span class="p">);</span>
<span class="linenos" data-linenos="40 "></span>    <span class="c1">// ...</span>
<span class="linenos" data-linenos="41 "></span><span class="p">}</span>
</code></pre></div>
<h2 id="3">3. 实用工具类知识</h2>
<h3 id="31">3.1 排序</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">bool</span> <span class="nf">mycmp</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>  <span class="cm">/*</span>
<span class="linenos" data-linenos="4 "></span><span class="cm">    a在b前返回true</span>
<span class="linenos" data-linenos="5 "></span><span class="cm">    a在b后返回false</span>
<span class="linenos" data-linenos="6 "></span><span class="cm">  */</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
<span class="linenos" data-linenos="8 "></span><span class="n">sort</span><span class="p">(</span><span class="n">arr</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">mycmp</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Computer</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// Computer 类重载了“&gt;”、“&lt;”</span>
<span class="linenos" data-linenos="3 "></span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">greater</span><span class="o">&lt;</span><span class="n">Computer</span><span class="o">&gt;</span><span class="p">());</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">struct</span> <span class="nc">Cmp</span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>  <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">Computer</span><span class="o">&amp;</span> <span class="n">_a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Computer</span><span class="o">&amp;</span> <span class="n">_b</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span>  <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">return</span> <span class="n">_a</span><span class="p">.</span><span class="n">stock</span> <span class="o">&gt;</span> <span class="n">_b</span><span class="p">.</span><span class="n">stock</span><span class="p">;</span>
<span class="linenos" data-linenos="6 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="7 "></span><span class="p">};</span>
<span class="linenos" data-linenos="8 "></span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">Cmp</span><span class="p">);</span>
</code></pre></div>
<h3 id="32">3.2 字符串类</h3>
<h3 id="33-fstream">3.3 文件读写 fstream</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">fstream</span> <span class="nf">fs1</span><span class="p">(</span><span class="s">&quot;./input.txt&quot;</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">in</span><span class="p">);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">fs1</span> <span class="o">&gt;&gt;</span> <span class="n">a</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">fstream</span> <span class="nf">fs2</span><span class="p">(</span><span class="s">&quot;./output.txt&quot;</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">fs2</span> <span class="o">&lt;&lt;</span> <span class="n">a</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">ifstream</span> <span class="nf">fin</span><span class="p">(</span><span class="s">&quot;./input.txt&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">ofstream</span> <span class="nf">fout</span><span class="p">(</span><span class="s">&quot;./output.txt&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">// 有f！！不是istream / ostream ！</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="c1">// 循环从文件读入未知长度的内容，直到读完为止。</span>
<span class="linenos" data-linenos="12 "></span><span class="k">while</span> <span class="p">(</span><span class="n">fin</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div>
<h3 id="34">3.4 输入</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// 读到空格</span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">str</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">// 读一整行</span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// 读到特定分隔符；可以读入换行符</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="sc">&#39;#&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">// 流操纵算子</span>
<span class="linenos" data-linenos="10 "></span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">ws</span><span class="p">;</span>  <span class="c1">// ws算子；除去前导空格</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">// 检查下一个字符，但并不读取。如果到结尾了就终止无限循环读入。</span>
<span class="linenos" data-linenos="12 "></span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cin</span><span class="p">.</span><span class="n">peek</span><span class="p">();</span> <span class="c1">// 返回的是char类型的字符！！比如0返回的是ASCII码48。</span>
<span class="linenos" data-linenos="13 "></span><span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">EOF</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>  <span class="k">break</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>  <span class="c1">//读取一个字符</span>
<span class="linenos" data-linenos="17 "></span><span class="n">cin</span><span class="p">.</span><span class="n">ignore</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">delim</span><span class="o">=</span><span class="n">EOF</span><span class="p">);</span> <span class="c1">//丢弃n个字符，或者直至遇到delim分隔符</span>
<span class="linenos" data-linenos="18 "></span><span class="n">cin</span><span class="p">.</span><span class="n">peek</span><span class="p">();</span> <span class="c1">//查看下一个字符</span>
<span class="linenos" data-linenos="19 "></span><span class="n">cin</span><span class="p">.</span><span class="n">putback</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">);</span>    <span class="c1">//返还一个字符</span>
<span class="linenos" data-linenos="20 "></span><span class="n">cin</span><span class="p">.</span><span class="n">unget</span><span class="p">();</span>    <span class="c1">//返还一个字符</span>
</code></pre></div>
<h3 id="35">3.5 输出</h3>
<p>格式化输出：</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">#include</span> <span class="cpf">&lt;iomanip&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">defaultfloat</span><span class="p">;</span>  <span class="c1">//还原默认输出格式</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mf">3.1415926</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>                <span class="c1">//输出精度设置为2 -&gt; 3.2</span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">oct</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">hex</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> 
<span class="linenos" data-linenos=" 7 "></span>                <span class="c1">//八进制输出 -&gt; 14  十六进制输出 -&gt; c</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">dec</span><span class="p">;</span>    <span class="c1">//还原十进制</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;*&#39;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>                <span class="c1">//设置对齐长度为3，对齐字符为* -&gt; **5</span>
<span class="linenos" data-linenos="11 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">fixed</span> <span class="o">&lt;&lt;</span> <span class="mf">2018.0</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="mf">0.0001</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>                <span class="c1">//浮点数补全 -&gt; 2018.000000 0.000100</span>
<span class="linenos" data-linenos="13 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="mf">2018.0</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="mf">0.0001</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>                <span class="c1">//科学计数法 -&gt; 2.018000e+03 1.000000e-04</span>
</code></pre></div>
<h3 id="36-string">3.6 string</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1">// 转换为常量char字符串</span>
<span class="linenos" data-linenos="2 "></span><span class="n">str</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
<span class="linenos" data-linenos="3 "></span><span class="n">str</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="sc">&#39;a&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="n">str</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="n">str</span> <span class="o">+=</span> <span class="n">s1</span><span class="p">;</span>
</code></pre></div>
<h4 id="361">3.6.1 截取</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">string</span> <span class="nf">s0</span><span class="p">(</span><span class="s">&quot;0123456789&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span>    <span class="n">string</span> <span class="nf">s1</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>    <span class="c1">// 从s0[3]开始，长度为4。结果：3456</span>
<span class="linenos" data-linenos="3 "></span>    <span class="n">string</span> <span class="nf">s2</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>   <span class="c1">// 从s0[4]开始直到结尾。结果：456789</span>
<span class="linenos" data-linenos="4 "></span>    <span class="n">string</span> <span class="nf">s3</span><span class="p">(</span><span class="s">&quot;0123456789&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="c1">// 从头开始，长度为4。（取前4。）结果：0123</span>
<span class="linenos" data-linenos="5 "></span>    <span class="n">string</span> <span class="nf">s4</span><span class="p">(</span><span class="n">s0</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">s0</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">6</span><span class="p">);</span>  <span class="c1">// 从s0[2]开始，到s0[5]（s0[6]之前）结束。结果：2345</span>
<span class="linenos" data-linenos="6 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="7 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s3</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="9 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s4</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<h4 id="362-charint-stoi">3.6.2 char[]转整型int (stoi)</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kt">int</span> <span class="nf">atoi</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// Usage:</span>
<span class="linenos" data-linenos=" 3 "></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 4 "></span><span class="kt">char</span> <span class="n">s</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">// 进制转换 （第二个参数是起始位置）</span>
<span class="linenos" data-linenos=" 8 "></span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">stoi</span><span class="p">(</span><span class="s">&quot;2001&quot;</span><span class="p">)</span>          <span class="c1">//a=2001</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span> <span class="n">sz</span><span class="p">;</span>   <span class="c1">// 一个大小数值 size_t alias</span>
<span class="linenos" data-linenos="10 "></span><span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">stoi</span><span class="p">(</span><span class="s">&quot;50 cats&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sz</span><span class="p">)</span>  <span class="c1">//b=50 sz=2 读入长度</span>
<span class="linenos" data-linenos="11 "></span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">stoi</span><span class="p">(</span><span class="s">&quot;40c3&quot;</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="c1">//c=0x40c3 十六进制</span>
<span class="linenos" data-linenos="12 "></span><span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">stoi</span><span class="p">(</span><span class="s">&quot;0x7f&quot;</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">//d=0x7f 自动检查进制</span>
</code></pre></div>
<p>反过来是itoa。然而这个在一些环境下是没有的。</p>
<p>https://blog.csdn.net/p312011150/article/details/81273888</p>
<h4 id="363-number-to-string">3.6.3 number to string</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="n">to_string</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</code></pre></div>
<h4 id="364-sstream">3.6.4 sstream 转换</h4>
<p>ss &lt;&lt; sth. 放进去</p>
<p>ss &gt;&gt; sth. 拿出来</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kt">int</span> <span class="nf">string_to_int</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="n">stringstream</span> <span class="n">ss</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="n">ss</span> <span class="o">&gt;&gt;</span> <span class="n">value</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">string_to_int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>  <span class="n">stringstream</span> <span class="n">ss</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="n">string</span> <span class="n">s</span><span class="p">(</span><span class="s">&quot;403&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">404</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="c1">// int to string</span>
<span class="linenos" data-linenos="11 "></span>    <span class="c1">// put int to ss</span>
<span class="linenos" data-linenos="12 "></span>    <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>    <span class="c1">// output ss to string</span>
<span class="linenos" data-linenos="14 "></span>    <span class="n">ss</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>    <span class="c1">// string to int</span>
<span class="linenos" data-linenos="18 "></span>    <span class="c1">// put string to ss</span>
<span class="linenos" data-linenos="19 "></span>    <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>    <span class="c1">// output ss to int</span>
<span class="linenos" data-linenos="21 "></span>    <span class="n">ss</span> <span class="o">&gt;&gt;</span> <span class="n">value</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span><span class="p">}</span>
</code></pre></div>
<h5 id="3641-sstream">3.6.4.1 sstream复用的坑</h5>
<p><code>ss.clear()</code> 是状态位。比如上一次用到末尾时下一次再用就需要clear。</p>
<p><code>ss.str("")</code>是清空内容以供复用。</p>
<h5 id="3642-sstream">3.6.4.2 sstream拼接多个字符串</h5>
<p>https://blog.csdn.net/liitdar/article/details/82598039</p>
<h6 id="36421-ss">3.6.4.2.1 新的ss一次性拼接</h6>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">s1</span> <span class="o">&lt;&lt;</span> <span class="n">s2</span> <span class="o">&lt;&lt;</span> <span class="n">s3</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<h6 id="36422-ss">3.6.4.2.2 用过的ss在尾部添加</h6>
<p><strong>需要用到clear来清楚“错误状态”。</strong></p>
<p>https://www.cnblogs.com/elenno/p/stringstream_clear.html</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">ss</span> <span class="o">&gt;&gt;</span> <span class="n">value</span><span class="p">;</span>    <span class="c1">// used</span>
<span class="linenos" data-linenos="2 "></span><span class="n">ss</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="linenos" data-linenos="3 "></span><span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, 403&quot;</span><span class="p">;</span>  <span class="c1">// add something after being used</span>
<span class="linenos" data-linenos="4 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<h5 id="3643-stringstream">3.6.4.3 基于stringstream的类型转换模板函数</h5>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InType</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutType</span><span class="o">&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">OutType</span> <span class="n">convert</span><span class="p">(</span><span class="n">InType</span> <span class="n">val</span><span class="p">)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">static</span> <span class="n">stringstream</span> <span class="n">ss</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span> <span class="c1">// empty the buffer</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="n">ss</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span> <span class="c1">// clear the state</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">val</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="n">OutType</span> <span class="n">res</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="n">ss</span> <span class="o">&gt;&gt;</span> <span class="n">res</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="37-vector">3.7 vector</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vec</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">};</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos" data-linenos=" 3 "></span>        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="n">vec</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">);</span>   <span class="c1">// 在index=4前插入3.5</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="n">vec</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>    <span class="c1">// 删除index=10（元素9被删掉了）</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="n">vec</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>   <span class="c1">// 在index=10前插入9</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="n">vec</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">11</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vec2</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// [左, 右)</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">vec</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">vec2</span><span class="p">)</span>
<span class="linenos" data-linenos="19 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="20 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>    <span class="p">}</span>
</code></pre></div>
<h3 id="38">3.8 正则表达式</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">#include</span> <span class="cpf">&lt;regex&gt;</span><span class="cp"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1">// 字符串能否完全匹配正则表达式</span>
<span class="linenos" data-linenos="2 "></span><span class="n">string</span> <span class="nf">s</span><span class="p">(</span><span class="s">&quot;subject&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="n">regex</span> <span class="nf">e</span><span class="p">(</span><span class="s">&quot;sub.*&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">regex_match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// 完全匹配；分组捕获</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// 每组用()标识；0号永远是被匹配的整个字符串本身</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">// 不想捕获的分组这样标记： (?:pattern)</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">string</span> <span class="nf">s</span><span class="p">(</span><span class="s">&quot;ver10&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">regex</span> <span class="nf">e</span><span class="p">(</span><span class="n">R</span><span class="s">&quot;(ver(\d+)</span><span class="p">)</span><span class="s">&quot;)</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">smatch</span> <span class="n">sm</span><span class="p">;</span>  <span class="c1">// smatch 对象存储分组结果</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">if</span> <span class="p">(</span><span class="n">regex_match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>  <span class="c1">// 判断是否成功并存储结果</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sm</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>  <span class="c1">// smatch对象可以直接输出；可以直接赋值给string对象</span>
<span class="linenos" data-linenos="11 "></span>  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">sm</span><span class="p">)</span>    <span class="c1">// for (int i = 0; i &lt; sm.size(); i++)</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// 搜索</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">// 搜索字符串中第一个能匹配的子串，存储到smatch对象中</span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">smatch</span> <span class="n">result</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">regex_research</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">re</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">smatch</span> <span class="n">sm</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">name</span> <span class="o">=</span> <span class="n">reg_match</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;(My name is |I am )(</span><span class="se">\\</span><span class="s">w+)&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">];</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">sm</span> <span class="o">=</span> <span class="n">reg_match</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;([1-9]</span><span class="se">\\</span><span class="s">d{0,3})[-.](1[0-2]|0?[1-9])[-.](3[01]|[12]</span><span class="se">\\</span><span class="s">d|0?[1-9])&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">birth</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">sm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sm</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sm</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<span class="linenos" data-linenos="10 "></span><span class="n">phone</span> <span class="o">=</span> <span class="n">reg_match</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">d{11}&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="linenos" data-linenos="11 "></span><span class="n">email</span> <span class="o">=</span> <span class="n">reg_match</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">w+.?@[a-zA-Z0-9_-]+(</span><span class="se">\\</span><span class="s">.[a-zA-Z0-9_-]+)+&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">// 替换</span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">string</span> <span class="nf">s</span><span class="p">(</span><span class="s">&quot;this subject has a submarine&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">regex</span> <span class="nf">e</span><span class="p">(</span><span class="n">R</span><span class="s">&quot;(sub[\S]*)&quot;)</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">//regex_replace返回值即为替换后的字符串 </span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">regex_replace</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="s">&quot;SUB&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>   <span class="c1">// this SUB has a SUB</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">// regex_replace(s, re, s1)</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">// 第三个参数，替换上去的字符串里，可以使用一些特殊符号</span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">// $&amp; 代表re匹配的子串</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">// $1, $2 代表re匹配的第1/2个分组</span>
<span class="linenos" data-linenos="10 "></span><span class="n">string</span> <span class="nf">s</span><span class="p">(</span><span class="s">&quot;this subject has a submarine&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span><span class="n">regex</span> <span class="nf">e</span><span class="p">(</span><span class="n">R</span><span class="s">&quot;((sub)</span><span class="p">([</span><span class="err">\</span><span class="n">S</span><span class="p">]</span><span class="o">*</span><span class="p">))</span><span class="s">&quot;)</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">regex_replace</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="s">&quot;$1 and [$2]&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>   <span class="c1">// this sub and [ject] has a sub and [marine]</span>
</code></pre></div>
<p>http://tool.chinaz.com/regex/</p>
<p>贪婪与懒惰</p>
<h3 id="39-isdigit">3.9 判断一个字符是否是数字 isdigit</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">isdigit</span><span class="p">(</span><span class="sc">&#39;3&#39;</span><span class="p">);</span>   <span class="c1">// 参数接收一个int；接收到EOF返回false可用于判断读入结束</span>
</code></pre></div>
                
              

  
    <div class="md-source-date">
      <small>
          Authors: <span class='git-page-authors git-authors'><a href='mailto:mailbox@valderfield.com'>Co1lin</a> (99.53%), <a href='mailto:luyuxuanleo@gmail.com'>Leo</a> (0.47%)</span>
      </small>
    </div>
  

              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" title="Back to top" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../DSA01/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              DSA01
            </div>
          </div>
        </a>
      
      
        <a href="../../Computer%20Network/1-introduction/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              1 Introduction
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>